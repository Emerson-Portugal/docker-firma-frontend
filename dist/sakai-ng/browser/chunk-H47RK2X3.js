import{a as Ae}from"./chunk-WTW5RUH2.js";import{e as Le,g as Fe}from"./chunk-FPNHGTLK.js";import{e as Ye,f as Ne,h as qe,i as Je,j as $e}from"./chunk-S2H22SWD.js";import{a as We,b as Ge}from"./chunk-SUQBSCDQ.js";import{a as nt}from"./chunk-SAF4IUW2.js";import{e as Oe,g as Re,l as Ee}from"./chunk-ZVWNBTKF.js";import{b as G,c as ze,l as Ue,p as je,q as He,r as Qe}from"./chunk-JT6TYXBW.js";import{$ as ke,M as ae,X as Ve,Y as J,_ as De,aa as Me,ba as $,ca as Be,ha as Ie}from"./chunk-OUHVS6X7.js";import"./chunk-TBYF2LDC.js";import{a as W}from"./chunk-XLKPKAOX.js";import{D as q,i as be,k as Ce,l as Y,n as xe,o as Se,p as Te,r as Pe,s as N,z}from"./chunk-ITE25VCI.js";import{$a as B,Ab as v,Bb as s,Cb as we,Db as te,Eb as f,Ga as a,Gb as h,Hb as _,Kb as ve,L as F,La as D,M as ue,Ob as x,P as Z,Pb as w,Q as V,Qb as ie,Rb as P,Ta as U,Tb as j,Ua as he,Ub as H,V as m,Vb as Q,W as u,Wb as A,X as ge,Xa as _e,Xb as R,Yb as E,Za as g,ec as L,fa as fe,fc as ye,ga as ee,gc as oe,hc as ne,ib as y,ic as re,jb as b,k as ce,mb as c,nb as d,ob as p,pb as T,tb as I,ub as O,v as me,vb as k,vc as S,wb as C,wc as M}from"./chunk-TKL4FGBT.js";import{a as de,e as ot,f as pe}from"./chunk-EQDQRRRY.js";var Ke=`
    .p-dataview {
        position: relative;
        border-color: dt('dataview.border.color');
        border-width: dt('dataview.border.width');
        border-style: solid;
        border-radius: dt('dataview.border.radius');
        padding: dt('dataview.padding');
    }

    .p-dataview-header {
        background: dt('dataview.header.background');
        color: dt('dataview.header.color');
        border-color: dt('dataview.header.border.color');
        border-width: dt('dataview.header.border.width');
        border-style: solid;
        padding: dt('dataview.header.padding');
        border-radius: dt('dataview.header.border.radius');
    }

    .p-dataview-content {
        background: dt('dataview.content.background');
        border-color: dt('dataview.content.border.color');
        border-width: dt('dataview.content.border.width');
        border-style: solid;
        color: dt('dataview.content.color');
        padding: dt('dataview.content.padding');
        border-radius: dt('dataview.content.border.radius');
    }

    .p-dataview-footer {
        background: dt('dataview.footer.background');
        color: dt('dataview.footer.color');
        border-color: dt('dataview.footer.border.color');
        border-width: dt('dataview.footer.border.width');
        border-style: solid;
        padding: dt('dataview.footer.padding');
        border-radius: dt('dataview.footer.border.radius');
    }

    .p-dataview-paginator-top {
        border-width: dt('dataview.paginator.top.border.width');
        border-color: dt('dataview.paginator.top.border.color');
        border-style: solid;
    }

    .p-dataview-paginator-bottom {
        border-width: dt('dataview.paginator.bottom.border.width');
        border-color: dt('dataview.paginator.bottom.border.color');
        border-style: solid;
    }

    .p-dataview-loading-overlay {
        position: absolute;
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 2;
    }
`;var at=["list"],st=["grid"],lt=["header"],dt=["emptymessage"],pt=["footer"],ct=["paginatorleft"],mt=["paginatorright"],ut=["paginatordropdownitem"],gt=["loadingicon"],ft=["listicon"],ht=["gridicon"],_t=[[["p-header"]],[["p-footer"]]],wt=["p-header","p-footer"],vt=()=>({position:"top"}),Ze=t=>({$implicit:t}),yt=()=>({position:"bottom"});function bt(t,o){if(t&1&&T(0,"i"),t&2){let e=s(2);x(e.cn(e.cx("loadingIcon"),"pi-spin"+e.loadingIcon))}}function Ct(t,o){}function xt(t,o){t&1&&g(0,Ct,0,0,"ng-template")}function St(t,o){if(t&1&&(I(0),ge(),T(1,"svg",3),g(2,xt,1,0,null,4),O()),t&2){let e=s(2);a(),x(e.cx("loadingIcon")),c("spin",!0),a(),c("ngTemplateOutlet",e.loadingicon)}}function Tt(t,o){if(t&1&&(d(0,"div")(1,"div"),y(2,bt,1,2,"i",1)(3,St,3,4,"ng-container"),p()()),t&2){let e=s();x(e.cx("loading")),a(),x(e.cx("loadingOverlay")),a(),b(e.loadingIcon?2:3)}}function Pt(t,o){t&1&&k(0)}function Lt(t,o){if(t&1&&(d(0,"div"),te(1),g(2,Pt,1,0,"ng-container",4),p()),t&2){let e=s();x(e.cx("header")),a(2),c("ngTemplateOutlet",e.headerTemplate)}}function Ft(t,o){if(t&1){let e=C();d(0,"p-paginator",5),v("onPageChange",function(i){m(e);let r=s();return u(r.paginate(i))}),p()}if(t&2){let e=s();c("rows",e.rows)("first",e.first)("totalRecords",e.totalRecords)("pageLinkSize",e.pageLinks)("alwaysShow",e.alwaysShowPaginator)("rowsPerPageOptions",e.rowsPerPageOptions)("appendTo",e.paginatorDropdownAppendTo)("dropdownScrollHeight",e.paginatorDropdownScrollHeight)("templateLeft",e.paginatorleft)("templateRight",e.paginatorright)("currentPageReportTemplate",e.currentPageReportTemplate)("showFirstLastIcon",e.showFirstLastIcon)("dropdownItemTemplate",e.paginatordropdownitem)("showCurrentPageReport",e.showCurrentPageReport)("showJumpToPageDropdown",e.showJumpToPageDropdown)("showPageLinks",e.showPageLinks)("styleClass",e.cn(e.cx("pcPaginator",R(17,vt)),e.paginatorStyleClass))}}function Vt(t,o){t&1&&k(0)}function Dt(t,o){if(t&1&&(g(0,Vt,1,0,"ng-container",6),L(1,"slice")),t&2){let e=s();c("ngTemplateOutlet",e.listTemplate)("ngTemplateOutletContext",E(6,Ze,e.paginator?ne(1,2,e.filteredValue||e.value,e.lazy?0:e.first,(e.lazy?0:e.first)+e.rows):e.filteredValue||e.value))}}function kt(t,o){t&1&&k(0)}function Mt(t,o){if(t&1&&(g(0,kt,1,0,"ng-container",6),L(1,"slice")),t&2){let e=s();c("ngTemplateOutlet",e.gridTemplate)("ngTemplateOutletContext",E(6,Ze,e.paginator?ne(1,2,e.filteredValue||e.value,e.lazy?0:e.first,(e.lazy?0:e.first)+e.rows):e.filteredValue||e.value))}}function Bt(t,o){if(t&1&&(I(0),w(1),O()),t&2){let e=s(2);a(),P(" ",e.emptyMessageLabel," ")}}function It(t,o){t&1&&k(0,null,0)}function Ot(t,o){if(t&1&&(d(0,"div"),g(1,Bt,2,1,"ng-container",7)(2,It,2,0,"ng-container",4),p()),t&2){let e=s();x(e.cx("emptyMessage")),a(),c("ngIf",!e.emptymessageTemplate)("ngIfElse",e.empty),a(),c("ngTemplateOutlet",e.emptymessageTemplate)}}function Rt(t,o){if(t&1){let e=C();d(0,"p-paginator",5),v("onPageChange",function(i){m(e);let r=s();return u(r.paginate(i))}),p()}if(t&2){let e=s();c("rows",e.rows)("first",e.first)("totalRecords",e.totalRecords)("pageLinkSize",e.pageLinks)("alwaysShow",e.alwaysShowPaginator)("rowsPerPageOptions",e.rowsPerPageOptions)("appendTo",e.paginatorDropdownAppendTo)("dropdownScrollHeight",e.paginatorDropdownScrollHeight)("templateLeft",e.paginatorleft)("templateRight",e.paginatorright)("currentPageReportTemplate",e.currentPageReportTemplate)("showFirstLastIcon",e.showFirstLastIcon)("dropdownItemTemplate",e.paginatordropdownitem)("showCurrentPageReport",e.showCurrentPageReport)("showJumpToPageDropdown",e.showJumpToPageDropdown)("showPageLinks",e.showPageLinks)("styleClass",e.cn(e.cx("pcPaginator",R(17,yt)),e.paginatorStyleClass))}}function Et(t,o){t&1&&k(0)}function zt(t,o){if(t&1&&(d(0,"div"),te(1,1),g(2,Et,1,0,"ng-container",4),p()),t&2){let e=s();x(e.cx("footer")),a(2),c("ngTemplateOutlet",e.footerTemplate)}}var Ut={root:({instance:t})=>["p-dataview p-component",{"p-dataview-list":t.layout==="list","p-dataview-grid":t.layout==="grid"}],header:"p-dataview-header",loading:"p-dataview-loading",loadingOverlay:"p-dataview-loading-overlay p-overlay-mask",loadingIcon:"p-dataview-loading-icon",pcPaginator:({position:t})=>"p-dataview-paginator-"+t,content:"p-dataview-content",emptyMessage:"p-dataview-empty-message",footer:"p-dataview-footer"},Xe=(()=>{class t extends Ie{name="dataview";theme=Ke;classes=Ut;static \u0275fac=(()=>{let e;return function(i){return(e||(e=ee(t)))(i||t)}})();static \u0275prov=F({token:t,factory:t.\u0275fac})}return t})();var le=(()=>{class t extends ze{paginator;rows;totalRecords;pageLinks=5;rowsPerPageOptions;paginatorPosition="bottom";paginatorStyleClass;alwaysShowPaginator=!0;paginatorDropdownAppendTo;paginatorDropdownScrollHeight="200px";currentPageReportTemplate="{currentPage} of {totalPages}";showCurrentPageReport;showJumpToPageDropdown;showFirstLastIcon=!0;showPageLinks=!0;lazy;lazyLoadOnInit=!0;emptyMessage="";styleClass;gridStyleClass="";trackBy=(e,n)=>n;filterBy;filterLocale;loading;loadingIcon;first=0;sortField;sortOrder;value;layout="list";onLazyLoad=new B;onPage=new B;onSort=new B;onChangeLayout=new B;listTemplate;gridTemplate;headerTemplate;emptymessageTemplate;footerTemplate;paginatorleft;paginatorright;paginatordropdownitem;loadingicon;listicon;gridicon;header;footer;_value;filteredValue;filterValue;initialized;_layout="list";translationSubscription;_componentStyle=V(Xe);get emptyMessageLabel(){return this.emptyMessage||this.config.getTranslation(Be.EMPTY_MESSAGE)}filterService=V(Ve);ngOnInit(){super.ngOnInit(),this.lazy&&this.lazyLoadOnInit&&this.onLazyLoad.emit(this.createLazyLoadMetadata()),this.translationSubscription=this.config.translationObserver.subscribe(()=>{this.cd.markForCheck()}),this.initialized=!0}ngAfterViewInit(){super.ngAfterViewInit()}ngOnChanges(e){super.ngOnChanges(e),e.layout&&!e.layout.firstChange&&this.onChangeLayout.emit({layout:e.layout.currentValue}),e.value&&(this._value=e.value.currentValue,this.updateTotalRecords(),!this.lazy&&this.hasFilter()&&this.filter(this.filterValue)),(e.sortField||e.sortOrder)&&(!this.lazy||this.initialized)&&this.sort()}updateTotalRecords(){this.totalRecords=this.lazy?this.totalRecords:this._value?this._value.length:0}paginate(e){this.first=e.first,this.rows=e.rows,this.lazy&&this.onLazyLoad.emit(this.createLazyLoadMetadata()),this.onPage.emit({first:this.first,rows:this.rows})}sort(){this.first=0,this.lazy?this.onLazyLoad.emit(this.createLazyLoadMetadata()):this.value&&(this.value.sort((e,n)=>{let i=ae(e,this.sortField),r=ae(n,this.sortField),l=null;return i==null&&r!=null?l=-1:i!=null&&r==null?l=1:i==null&&r==null?l=0:typeof i=="string"&&typeof r=="string"?l=i.localeCompare(r):l=i<r?-1:i>r?1:0,this.sortOrder*l}),this.hasFilter()&&this.filter(this.filterValue)),this.onSort.emit({sortField:this.sortField,sortOrder:this.sortOrder})}isEmpty(){let e=this.filteredValue||this.value;return e==null||e.length==0}createLazyLoadMetadata(){return{first:this.first,rows:this.rows,sortField:this.sortField,sortOrder:this.sortOrder}}getBlockableElement(){return this.el.nativeElement.children[0]}filter(e,n="contains"){if(this.filterValue=e,this.value&&this.value.length){let i=this.filterBy.split(",");this.filteredValue=this.filterService.filter(this.value,i,e,n,this.filterLocale),this.filteredValue.length===this.value.length&&(this.filteredValue=null),this.paginator&&(this.first=0,this.totalRecords=this.filteredValue?this.filteredValue.length:this.value?this.value.length:0),this.cd.markForCheck()}}hasFilter(){return this.filterValue&&this.filterValue.trim().length>0}ngOnDestroy(){this.translationSubscription&&this.translationSubscription.unsubscribe(),super.ngOnDestroy()}static \u0275fac=(()=>{let e;return function(i){return(e||(e=ee(t)))(i||t)}})();static \u0275cmp=U({type:t,selectors:[["p-dataView"],["p-dataview"],["p-data-view"]],contentQueries:function(n,i,r){if(n&1&&(f(r,at,5),f(r,st,5),f(r,lt,5),f(r,dt,5),f(r,pt,5),f(r,ct,5),f(r,mt,5),f(r,ut,5),f(r,gt,5),f(r,ft,5),f(r,ht,5),f(r,De,5),f(r,ke,5)),n&2){let l;h(l=_())&&(i.listTemplate=l.first),h(l=_())&&(i.gridTemplate=l.first),h(l=_())&&(i.headerTemplate=l.first),h(l=_())&&(i.emptymessageTemplate=l.first),h(l=_())&&(i.footerTemplate=l.first),h(l=_())&&(i.paginatorleft=l.first),h(l=_())&&(i.paginatorright=l.first),h(l=_())&&(i.paginatordropdownitem=l.first),h(l=_())&&(i.loadingicon=l.first),h(l=_())&&(i.listicon=l.first),h(l=_())&&(i.gridicon=l.first),h(l=_())&&(i.header=l.first),h(l=_())&&(i.footer=l.first)}},hostVars:2,hostBindings:function(n,i){n&2&&x(i.cn(i.cx("root"),i.styleClass))},inputs:{paginator:[2,"paginator","paginator",S],rows:[2,"rows","rows",M],totalRecords:[2,"totalRecords","totalRecords",M],pageLinks:[2,"pageLinks","pageLinks",M],rowsPerPageOptions:"rowsPerPageOptions",paginatorPosition:"paginatorPosition",paginatorStyleClass:"paginatorStyleClass",alwaysShowPaginator:[2,"alwaysShowPaginator","alwaysShowPaginator",S],paginatorDropdownAppendTo:"paginatorDropdownAppendTo",paginatorDropdownScrollHeight:"paginatorDropdownScrollHeight",currentPageReportTemplate:"currentPageReportTemplate",showCurrentPageReport:[2,"showCurrentPageReport","showCurrentPageReport",S],showJumpToPageDropdown:[2,"showJumpToPageDropdown","showJumpToPageDropdown",S],showFirstLastIcon:[2,"showFirstLastIcon","showFirstLastIcon",S],showPageLinks:[2,"showPageLinks","showPageLinks",S],lazy:[2,"lazy","lazy",S],lazyLoadOnInit:[2,"lazyLoadOnInit","lazyLoadOnInit",S],emptyMessage:"emptyMessage",styleClass:"styleClass",gridStyleClass:"gridStyleClass",trackBy:"trackBy",filterBy:"filterBy",filterLocale:"filterLocale",loading:[2,"loading","loading",S],loadingIcon:"loadingIcon",first:[2,"first","first",M],sortField:"sortField",sortOrder:[2,"sortOrder","sortOrder",M],value:"value",layout:"layout"},outputs:{onLazyLoad:"onLazyLoad",onPage:"onPage",onSort:"onSort",onChangeLayout:"onChangeLayout"},features:[A([Xe]),_e,fe],ngContentSelectors:wt,decls:9,vars:10,consts:[["empty",""],[3,"class"],[3,"rows","first","totalRecords","pageLinkSize","alwaysShow","rowsPerPageOptions","appendTo","dropdownScrollHeight","templateLeft","templateRight","currentPageReportTemplate","showFirstLastIcon","dropdownItemTemplate","showCurrentPageReport","showJumpToPageDropdown","showPageLinks","styleClass"],["data-p-icon","spinner",3,"spin"],[4,"ngTemplateOutlet"],[3,"onPageChange","rows","first","totalRecords","pageLinkSize","alwaysShow","rowsPerPageOptions","appendTo","dropdownScrollHeight","templateLeft","templateRight","currentPageReportTemplate","showFirstLastIcon","dropdownItemTemplate","showCurrentPageReport","showJumpToPageDropdown","showPageLinks","styleClass"],[4,"ngTemplateOutlet","ngTemplateOutletContext"],[4,"ngIf","ngIfElse"]],template:function(n,i){n&1&&(we(_t),y(0,Tt,4,5,"div",1),y(1,Lt,3,3,"div",1),y(2,Ft,1,18,"p-paginator",2),d(3,"div"),y(4,Dt,2,8,"ng-container"),y(5,Mt,2,8,"ng-container"),y(6,Ot,3,5,"div",1),p(),y(7,Rt,1,18,"p-paginator",2),y(8,zt,3,3,"div",1)),n&2&&(b(i.loading?0:-1),a(),b(i.header||i.headerTemplate?1:-1),a(),b(i.paginator&&(i.paginatorPosition==="top"||i.paginatorPosition=="both")?2:-1),a(),x(i.cx("content")),a(),b(i.layout==="list"?4:-1),a(),b(i.layout==="grid"?5:-1),a(),b(i.isEmpty()&&!i.loading?6:-1),a(),b(i.paginator&&(i.paginatorPosition==="bottom"||i.paginatorPosition=="both")?7:-1),a(),b(i.footer||i.footerTemplate?8:-1))},dependencies:[N,Y,xe,Je,qe,Ue,$,Pe],encapsulation:2,changeDetection:0})}return t})(),et=(()=>{class t{static \u0275fac=function(n){return new(n||t)};static \u0275mod=he({type:t});static \u0275inj=ue({imports:[le,$,$]})}return t})();var it=ot(nt());var K=class t{apiUrl=`${G.BASE_URL}/empleado/mis-documentos`;http=V(q);tokenService=V(W);getAuthHeaders(){let o=this.tokenService.getToken();return new z({Authorization:`Bearer ${o}`,Accept:"application/json"})}getToken(){let o=localStorage.getItem("authToken");if(o)return o;let e=localStorage.getItem("user");if(e)try{let n=JSON.parse(e);return n?.token||n?.access_token||null}catch{return null}return null}getMyDocuments(){let o=this.getToken(),e=new z(de({accept:"application/json"},o?{Authorization:`Bearer ${o}`}:{}));return this.http.get(`${this.apiUrl}`,{headers:e}).pipe(me(n=>(console.error("Error al obtener documentos",n),ce(()=>n))))}static \u0275fac=function(e){return new(e||t)};static \u0275prov=F({token:t,factory:t.\u0275fac,providedIn:"root"})};var X=class t{constructor(o,e){this.http=o;this.tokenSrv=e}apiUrl=`${G.BASE_URL}/empleado/verificar-firma`;authHeaders(){let o=new z({Accept:"application/json"}),e=this.tokenSrv.getToken();return e&&(o=o.set("Authorization",`Bearer ${e}`)),o}verificarFirma(o){return this.http.get(`${this.apiUrl}/${o}`,{headers:this.authHeaders()})}static \u0275fac=function(e){return new(e||t)(Z(q),Z(W))};static \u0275prov=F({token:t,factory:t.\u0275fac,providedIn:"root"})};var At=()=>[5,10,25,50],Yt=t=>({"border-t border-surface":t});function Nt(t,o){if(t&1){let e=C();d(0,"p-button",10),v("click",function(){m(e);let i=s();return u(i.goBackToYears())}),p()}}function qt(t,o){if(t&1){let e=C();d(0,"p-button",10),v("click",function(){m(e);let i=s();return u(i.home())}),p()}}function Jt(t,o){if(t&1){let e=C();d(0,"div",13),v("click",function(){let i=m(e).$implicit,r=s(2);return u(r.selectYear(i))}),T(1,"i",14),d(2,"span",15),w(3),p()()}if(t&2){let e=o.$implicit;a(3),ie(e)}}function $t(t,o){if(t&1&&(d(0,"div",11),g(1,Jt,4,1,"div",12),p()),t&2){let e=s();a(),c("ngForOf",e.years)}}function Wt(t,o){if(t&1){let e=C();I(0),d(1,"p-button",37),v("onClick",function(){m(e);let i=s().$implicit,r=s(3);return u(r.verDocumento(i))}),p(),O()}}function Gt(t,o){if(t&1){let e=C();d(0,"p-button",38),v("onClick",function(){m(e);let i=s().$implicit,r=s(3);return u(r.descargar(i))}),p()}if(t&2){let e=s().$implicit,n=s(3);c("icon",n.validando[e.id]?"pi pi-spin pi-spinner":"pi pi-pencil")("label",n.validando[e.id]?"Validando...":"Firmar")("disabled",n.validando[e.id])}}function Kt(t,o){if(t&1&&(d(0,"div",29)(1,"div",30),w(2),p(),d(3,"div",31),w(4),p(),d(5,"div",32),w(6),L(7,"date"),p(),d(8,"div",32),w(9),L(10,"date"),p(),d(11,"div",33),T(12,"p-tag",34),L(13,"titlecase"),T(14,"span",35),g(15,Wt,2,0,"ng-container",36)(16,Gt,1,3,"ng-template",null,1,re),p()()),t&2){let e=o.$implicit,n=o.index,i=ve(17),r=s(3);c("ngClass",E(17,Yt,n!==0)),a(2),P(" ",e.nombre_archivo," "),a(2),P("Usuario: ",e.nombre_usuario),a(2),P("Subido: ",oe(7,9,e.subido_en,"medium")),a(3),P(" Firmado: ",e.firmado_en?oe(10,12,e.firmado_en,"medium"):"\u2014"," "),a(3),c("value",ye(13,15,e.estado))("severity",r.getSeverity(e.estado)),a(3),c("ngIf",e.estado==="firmado")("ngIfElse",i)}}function Xt(t,o){if(t&1&&(d(0,"div",2),g(1,Kt,18,19,"div",28),p()),t&2){let e=o.$implicit,n=s(2);a(),c("ngForOf",e)("ngForTrackBy",n.trackDoc)}}function Zt(t,o){t&1&&(d(0,"div",39),w(1,"No hay facturas."),p())}function ei(t,o){if(t&1&&(d(0,"div",40),w(1),p()),t&2){let e=s(2);a(),ie(e.error)}}function ti(t,o){if(t&1){let e=C();d(0,"div")(1,"div",16)(2,"div",2)(3,"label",17),w(4,"Estado"),p(),d(5,"p-select",18),Q("ngModelChange",function(i){m(e);let r=s();return H(r.estadoFiltro,i)||(r.estadoFiltro=i),u(i)}),v("onChange",function(){m(e);let i=s();return u(i.aplicarFiltros())}),p()(),d(6,"div",2)(7,"label",17),w(8,"Mes"),p(),d(9,"p-select",19),Q("ngModelChange",function(i){m(e);let r=s();return H(r.mesFiltro,i)||(r.mesFiltro=i),u(i)}),v("onChange",function(){m(e);let i=s();return u(i.aplicarFiltros())}),p()(),d(10,"div",20)(11,"div",21)(12,"label",17),w(13,"Ordenar por"),p(),d(14,"p-select",22),Q("ngModelChange",function(i){m(e);let r=s();return H(r.ordenarPor,i)||(r.ordenarPor=i),u(i)}),v("onChange",function(){m(e);let i=s();return u(i.aplicarFiltros())}),p()(),d(15,"div",23)(16,"button",24),v("click",function(){m(e);let i=s();return u(i.limpiarFiltros())}),p()()()(),d(17,"p-dataview",25),g(18,Xt,2,2,"ng-template",null,0,re)(20,Zt,2,0,"ng-template",26),p(),g(21,ei,2,1,"div",27),p()}if(t&2){let e=s();a(5),c("options",e.estadoOptions),j("ngModel",e.estadoFiltro),c("showClear",!0),a(4),c("options",e.meses),j("ngModel",e.mesFiltro),c("showClear",!0),a(5),c("options",e.opcionesOrden),j("ngModel",e.ordenarPor),a(3),c("value",e.documentosFiltrados)("paginator",!0)("rows",e.rows)("rowsPerPageOptions",R(15,At))("first",e.first)("alwaysShowPaginator",!1),a(4),c("ngIf",e.error)}}var tt=class t{constructor(o,e,n,i,r){this.listSvc=o;this.signSts=e;this.router=n;this.route=i;this.messageService=r}years=[];selectedYear=null;showYearView=!0;showDocumentView=!1;loading=!1;error=null;documentos=[];documentosFiltrados=[];validando={};estadoFiltro="all";mesFiltro=null;ordenarPor="recientes";estadoOptions=[{label:"Todos",value:"all"},{label:"Pendiente",value:"pendiente"},{label:"Firmado",value:"firmado"}];opcionesOrden=[{label:"M\xE1s recientes primero",value:"recientes"},{label:"M\xE1s antiguos primero",value:"antiguos"}];meses=[{label:"Enero",value:1},{label:"Febrero",value:2},{label:"Marzo",value:3},{label:"Abril",value:4},{label:"Mayo",value:5},{label:"Junio",value:6},{label:"Julio",value:7},{label:"Agosto",value:8},{label:"Septiembre",value:9},{label:"Octubre",value:10},{label:"Noviembre",value:11},{label:"Diciembre",value:12}];rows=10;first=0;ngOnInit(){this.route.queryParams.subscribe(o=>{let e=o.year,n=e?Number(e):null;n&&!Number.isNaN(n)?(this.selectedYear=n,this.showYearView=!1,this.showDocumentView=!0):(this.selectedYear=null,this.showYearView=!0,this.showDocumentView=!1),this.aplicarFiltros()}),this.cargar()}cargar(){this.loading=!0,this.error=null,this.listSvc.getMyDocuments().subscribe({next:o=>{this.documentos=o.documentos??[];let e=new Set;this.documentos.forEach(n=>{if(n.subido_en){let i=new Date(n.subido_en).getFullYear();e.add(i)}}),this.years=Array.from(e).sort((n,i)=>i-n),this.aplicarFiltros(),this.loading=!1},error:o=>{this.error=o?.error?.detail||"No se pudieron cargar los documentos.",this.documentos=[],this.documentosFiltrados=[],this.years=[],this.loading=!1}})}limpiarFiltros(){this.estadoFiltro="all",this.mesFiltro=null,this.ordenarPor="recientes",this.first=0,this.aplicarFiltros()}aplicarFiltros(){let o=this.documentos.filter(e=>{let n=this.estadoFiltro==="all"||(e.estado||"").toLowerCase()===this.estadoFiltro,i=!0;this.mesFiltro&&(i=new Date(e.subido_en).getMonth()+1===this.mesFiltro);let r=!0;return this.selectedYear&&(r=new Date(e.subido_en).getFullYear()===this.selectedYear),n&&i&&r});o.sort((e,n)=>{let i=new Date(e.subido_en).getTime(),r=new Date(n.subido_en).getTime();return this.ordenarPor==="recientes"?r-i:i-r}),this.documentosFiltrados=o}getSeverity(o){let e=(o||"").toLowerCase();return e==="firmado"?"success":e==="pendiente"?"danger":"info"}trackDoc=(o,e)=>e.id;selectYear(o){this.selectedYear=o,this.showYearView=!1,this.showDocumentView=!0,this.aplicarFiltros(),this.router.navigate([],{relativeTo:this.route,queryParams:{year:o},queryParamsHandling:"merge"})}goBackToYears(){this.selectedYear=null,this.showYearView=!0,this.showDocumentView=!1,this.aplicarFiltros(),this.router.navigate([],{relativeTo:this.route,queryParams:{year:null},queryParamsHandling:"merge"})}descargar(o){return pe(this,null,function*(){this.validando[o.id]=!0;try{let e=yield this.signSts.verificarFirma(o.id).toPromise();if(e?.puede_firmar)this.router.navigate(["/signature/sign-ballots",o.id],{state:{doc:o},queryParamsHandling:"preserve"});else{let n=e?.documento_pendiente,i=n?`Tienes el documento "${n.nombre}" (${n.fecha}) pendiente de firmar.`:"Tienes documentos pendientes de firmar.";yield it.default.fire({title:"Documentos pendientes",html:`${i}<br>Por favor, f\xEDrmalos en orden cronol\xF3gico.`,icon:"warning",confirmButtonText:"Entendido",confirmButtonColor:"#3085d6",showCloseButton:!0})}}catch(e){console.error("Error al verificar documentos:",e),this.messageService.add({severity:"error",summary:"Error",detail:"Ocurri\xF3 un error al verificar el estado del documento",life:5e3})}finally{this.validando[o.id]=!1}})}verDocumento(o){this.router.navigate(["/signature/sign-ballots",o.id],{state:{doc:o},queryParamsHandling:"preserve"})}home(){window.location.href="/signature/home"}static \u0275fac=function(e){return new(e||t)(D(K),D(X),D(Fe),D(Le),D(J))};static \u0275cmp=U({type:t,selectors:[["app-list-ballots-user"]],features:[A([J])],decls:10,vars:6,consts:[["list",""],["firmarButton",""],[1,"flex","flex-col"],["message","Cargando documentos...",3,"isLoading"],[1,"card","relative"],[1,"flex","items-center","mb-3"],["icon","pi pi-arrow-left","styleClass","p-button-danger p-button-rounded p-button-text mr-2",3,"click",4,"ngIf"],[1,"font-semibold","text-xl"],["class","grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6 p-4 justify-center",4,"ngIf"],[4,"ngIf"],["icon","pi pi-arrow-left","styleClass","p-button-danger p-button-rounded p-button-text mr-2",3,"click"],[1,"grid","grid-cols-1","sm:grid-cols-2","md:grid-cols-3","lg:grid-cols-4","gap-6","p-4","justify-center"],["class","p-6 border rounded shadow hover:shadow-md cursor-pointer transition-transform transform hover:-translate-y-1 bg-white flex flex-col items-center",3,"click",4,"ngFor","ngForOf"],[1,"p-6","border","rounded","shadow","hover:shadow-md","cursor-pointer","transition-transform","transform","hover:-translate-y-1","bg-white","flex","flex-col","items-center",3,"click"],[1,"pi","pi-folder","text-5xl","text-primary-500","mb-3"],[1,"font-semibold","text-lg"],[1,"grid","grid-cols-1","md:grid-cols-3","gap-4","mb-4"],[1,"block","text-600","text-sm","font-medium","mb-2"],["optionLabel","label","optionValue","value","placeholder","Filtrar por estado","styleClass","w-full",3,"ngModelChange","onChange","options","ngModel","showClear"],["optionLabel","label","optionValue","value","placeholder","Filtrar por mes","styleClass","w-full",3,"ngModelChange","onChange","options","ngModel","showClear"],[1,"flex","items-end","gap-2"],[1,"flex-1","flex","flex-col"],["optionLabel","label","optionValue","value","styleClass","w-full",3,"ngModelChange","onChange","options","ngModel"],[1,"flex","items-end"],["pButton","","type","button","icon","pi pi-filter-slash","label","Limpiar",1,"p-button-text","p-button-sm",2,"height","36px","margin-bottom","2px",3,"click"],["layout","list","paginatorPosition","both",3,"value","paginator","rows","rowsPerPageOptions","first","alwaysShowPaginator"],["pTemplate","empty"],["class","mt-3 text-red-600",4,"ngIf"],["class","flex flex-col p-6 gap-3",3,"ngClass",4,"ngFor","ngForOf","ngForTrackBy"],[1,"flex","flex-col","p-6","gap-3",3,"ngClass"],[1,"text-lg","font-medium","break-all","text-blue-600"],[1,"mt-1","text-surface-500","text-sm"],[1,"text-surface-500","text-sm"],[1,"mt-2","flex","items-center","gap-3","flex-nowrap"],[1,"shrink-0",3,"value","severity"],[1,"grow"],[4,"ngIf","ngIfElse"],["icon","pi pi-eye","label","Ver","severity","info","raised","","size","small",1,"shrink-0","whitespace-nowrap","px-5","h-9","rounded-md",3,"onClick"],["severity","success","raised","","size","small",1,"shrink-0","whitespace-nowrap","px-5","h-9","rounded-md",3,"onClick","icon","label","disabled"],[1,"p-6","text-center","text-surface-500"],[1,"mt-3","text-red-600"]],template:function(e,n){e&1&&(d(0,"div",2),T(1,"app-loading",3),d(2,"div",4)(3,"div",5),g(4,Nt,1,0,"p-button",6)(5,qt,1,0,"p-button",6),d(6,"div",7),w(7),p()(),g(8,$t,2,1,"div",8)(9,ti,22,16,"div",9),p()()),e&2&&(a(),c("isLoading",n.loading),a(3),c("ngIf",!n.showYearView),a(),c("ngIf",n.showYearView),a(2),P(" ",n.showYearView?"Mis Documentos":"Documentos del a\xF1o "+n.selectedYear," "),a(),c("ngIf",n.showYearView),a(),c("ngIf",n.showDocumentView))},dependencies:[N,be,Ce,Y,Ee,Oe,Re,et,le,Me,$e,Ge,We,Qe,je,He,Ae,Ne,Ye,Se,Te],encapsulation:2})};export{tt as ListBallotsUserComponent};
