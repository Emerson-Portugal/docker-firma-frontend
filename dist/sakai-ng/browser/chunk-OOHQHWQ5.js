import{b as h}from"./chunk-WWP5TSHS.js";import{a as v}from"./chunk-XLKPKAOX.js";import{A as d,D as u,z as l}from"./chunk-ITE25VCI.js";import{H as j,L as p,P as m,Q as c,c as k,g,k as i,n as y,v as o}from"./chunk-TKL4FGBT.js";import{f as A}from"./chunk-EQDQRRRY.js";var b=class n{baseUrl=h.BASE_URL;_http=c(u);tokenService=c(v);jsonAuthHeaders(){return this.tokenService.getAuthHeaders().set("Content-Type","application/json")}loginDni(e){return this._http.post(`${this.baseUrl}/auth/auth/login`,e,{headers:new l({"Content-Type":"application/json"})}).pipe(o(t=>i(()=>t)))}static \u0275fac=function(t){return new(t||n)};static \u0275prov=p({token:n,factory:n.\u0275fac,providedIn:"root"})};var S=class n{baseUrl;_http=c(u);userSubject=new g(null);constructor(){this.baseUrl=h.BASE_URL}getToken(){return localStorage.getItem("authToken")}setUser(e){this.userSubject.next(e)}getUser(){return this.userSubject.asObservable()}getAccountSession(e){let t=new l({"Content-Type":"application/json",Authorization:`Bearer ${e}`});return this._http.get(`${this.baseUrl}/account/getAccountSession`,{headers:t}).pipe(o(r=>(console.error("Error en GetAccountByUserName:",r),i(r))))}static \u0275fac=function(t){return new(t||n)};static \u0275prov=p({token:n,factory:n.\u0275fac,providedIn:"root"})};var w=class n{constructor(e,t,r){this.authService=e;this.sessionService=t;this.tokenService=r;this.baseUrl=h.BASE_URL,this.loadUserSession()}userSubject=new g(null);sessionChange=new g(null);user$=this.userSubject.asObservable();baseUrl;_http=c(u);loginDni(e){return new k(t=>{this.authService.loginDni(e).subscribe(r=>{let s=r.access_token,a=(()=>{try{let U=JSON.parse(atob(s.split(".")[1]));return typeof U?.exp=="number"?U.exp:void 0}catch{return}})(),f=Math.floor(Date.now()/1e3),R=a?Math.max(a-f,1):void 0;this.tokenService.setToken(s,R),this.tokenService.setUser(r.user),this.userSubject.next(r.user),this.sessionService.setUser(r.user),this.sessionChange.next(!0),t.next(r.user),t.complete()},r=>t.error(this.formatError(r)))})}loadUserSession(){let e=this.tokenService.getToken(),t=this.tokenService.getUser();e&&t?(this.userSubject.next(t),this.sessionService.setUser(t)):e?this.sessionService.getAccountSession(e).subscribe(r=>{if(r.isSuccess){let s=r.data;this.sessionService.setUser(s),this.userSubject.next(s),this.tokenService.setUser(s)}else this.logout()},r=>{console.log("No se pudo cargar la sesi\xF3n:",r),this.logout()}):this.logout()}getUser(){return this.user$}logout(){console.log("Ejecutando logout..."),this.tokenService.clearAll(),this.userSubject.next(null),this.clearSession()}clearSession(){this.sessionService.setUser(null)}formatError(e){return e.error?.messages?.length>0?e.error.messages.map(t=>t.description):["Ocurri\xF3 un error inesperado."]}CreateAccount(e){let t=this.tokenService.getAuthHeaders();return this._http.post(`${this.baseUrl}/account`,e,{headers:t}).pipe(o(r=>i(r)))}GetAccountAll(e){let t=this.tokenService.getAuthHeaders(),r=new d;return Object.entries(e||{}).forEach(([s,a])=>{a!=null&&(r=r.set(s,a.toString()))}),this._http.get(`${this.baseUrl}/account/GetAccountAll`,{headers:t,params:r}).pipe(o(s=>i(s)))}GetAccountByUserName(e){let t=this.tokenService.getAuthHeaders(),r=new d().set("userName",e);return this._http.get(`${this.baseUrl}/account/GetAccountByUserName`,{headers:t,params:r}).pipe(o(s=>i(s)))}SendMailAccountActivate(e){let t=this.tokenService.getAuthHeaders();return this._http.patch(`${this.baseUrl}/account/${e}/sendmail`,null,{headers:t}).pipe(o(r=>i(r)))}ViewAdvertisement(e,t){let r=this.tokenService.getAuthHeaders();return this._http.put(`${this.baseUrl}/advertisement/${e}/view`,t,{headers:r}).pipe(o(s=>i(s)))}WhatsappAdvertisement(e){let t=this.tokenService.getAuthHeaders();return this._http.put(`${this.baseUrl}/advertisement/${e}/whatsapp`,{},{headers:t}).pipe(o(r=>i(r)))}convertImageToBase64(e){return A(this,null,function*(){let t=yield this._http.get(e,{responseType:"blob"}).toPromise();return new Promise((r,s)=>{let a=new FileReader;a.readAsDataURL(t),a.onloadend=()=>r(a.result.split(",")[1]),a.onerror=f=>s(f)})})}updateAccount(e,t){let r=this.tokenService.getAuthHeaders();return this._http.put(`${this.baseUrl}/account/${e}`,t,{headers:r}).pipe(o(s=>i(s)))}static \u0275fac=function(t){return new(t||n)(m(b),m(S),m(v))};static \u0275prov=p({token:n,factory:n.\u0275fac,providedIn:"root"})},x=class n{apiUrl=`${h.BASE_URL}/soporte/usuarios`;http=c(u);tokenService=c(v);getAuthHeaders(){let e=this.tokenService.getToken();return new l({Authorization:`Bearer ${e}`,"Content-Type":"application/json",Accept:"application"})}listUsers(e=0,t=10){let r=new d().set("skip",e.toString()).set("limit",t.toString());return console.log("Fetching users from:",this.apiUrl),console.log("With params:",{skip:e,limit:t}),this.http.get(this.apiUrl,{headers:this.getAuthHeaders(),params:r}).pipe(y(s=>({data:s,total:s.length})),j(s=>(console.log("Mapped response:",s),s)),o(s=>(console.error("Error fetching users:",s),i(()=>s))))}createUser(e){return this.http.post(this.apiUrl,e,{headers:this.getAuthHeaders()})}static \u0275fac=function(t){return new(t||n)};static \u0275prov=p({token:n,factory:n.\u0275fac,providedIn:"root"})},C=class n{apiUrl=`${h.BASE_URL}/soporte/usuarios`;http=c(u);tokenService=c(v);getAuthHeaders(){let e=this.tokenService.getToken();return new l({Authorization:`Bearer ${e}`,"Content-Type":"application/json",Accept:"application/json"})}createUser(e){return this.http.post(this.apiUrl,e,{headers:this.getAuthHeaders()})}static \u0275fac=function(t){return new(t||n)};static \u0275prov=p({token:n,factory:n.\u0275fac,providedIn:"root"})};export{w as a,x as b};
