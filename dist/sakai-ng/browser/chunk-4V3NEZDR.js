import{a as Je}from"./chunk-WTW5RUH2.js";import{e as Me,g as Be}from"./chunk-FPNHGTLK.js";import{e as We,f as Ge,h as Ke,i as Xe,j as Ze}from"./chunk-6VRQBWCG.js";import{a as et,b as tt}from"./chunk-XC72IWV7.js";import{a as pt}from"./chunk-SAF4IUW2.js";import{e as Ue,g as Ne,l as He}from"./chunk-W2Y5NTF3.js";import{b as K,c as Qe,l as Ye,p as Ae,q as qe,r as $e}from"./chunk-WWP5TSHS.js";import{$ as Oe,M as de,X as Ie,Y as J,_ as Re,aa as Ee,ba as W,ca as ze,ha as je}from"./chunk-OUHVS6X7.js";import"./chunk-TBYF2LDC.js";import{a as G}from"./chunk-XLKPKAOX.js";import{D as $,i as Pe,k as Le,l as A,n as Fe,o as De,p as Ve,r as ke,s as q,z}from"./chunk-ITE25VCI.js";import{$a as B,Ab as v,Bb as l,Cb as xe,Db as ne,Eb as f,Ga as s,Gb as h,Hb as _,Kb as Te,L as F,La as V,M as we,Ob as x,P as ie,Pb as w,Q as D,Qb as re,Rb as P,Ta as U,Tb as N,Ua as be,Ub as H,V as m,Vb as Q,W as u,Wb as Y,X as ve,Xa as Ce,Xb as O,Yb as E,Za as g,ec as L,fa as ye,fc as Se,ga as oe,gc as ae,hc as se,ib as y,ic as le,jb as b,k as he,mb as p,nb as d,ob as c,pb as S,tb as I,ub as R,v as _e,vb as k,vc as T,wb as C,wc as M}from"./chunk-TKL4FGBT.js";import{a as ge,e as ct,f as fe}from"./chunk-EQDQRRRY.js";var it=`
    .p-dataview {
        position: relative;
        border-color: dt('dataview.border.color');
        border-width: dt('dataview.border.width');
        border-style: solid;
        border-radius: dt('dataview.border.radius');
        padding: dt('dataview.padding');
    }

    .p-dataview-header {
        background: dt('dataview.header.background');
        color: dt('dataview.header.color');
        border-color: dt('dataview.header.border.color');
        border-width: dt('dataview.header.border.width');
        border-style: solid;
        padding: dt('dataview.header.padding');
        border-radius: dt('dataview.header.border.radius');
    }

    .p-dataview-content {
        background: dt('dataview.content.background');
        border-color: dt('dataview.content.border.color');
        border-width: dt('dataview.content.border.width');
        border-style: solid;
        color: dt('dataview.content.color');
        padding: dt('dataview.content.padding');
        border-radius: dt('dataview.content.border.radius');
    }

    .p-dataview-footer {
        background: dt('dataview.footer.background');
        color: dt('dataview.footer.color');
        border-color: dt('dataview.footer.border.color');
        border-width: dt('dataview.footer.border.width');
        border-style: solid;
        padding: dt('dataview.footer.padding');
        border-radius: dt('dataview.footer.border.radius');
    }

    .p-dataview-paginator-top {
        border-width: dt('dataview.paginator.top.border.width');
        border-color: dt('dataview.paginator.top.border.color');
        border-style: solid;
    }

    .p-dataview-paginator-bottom {
        border-width: dt('dataview.paginator.bottom.border.width');
        border-color: dt('dataview.paginator.bottom.border.color');
        border-style: solid;
    }

    .p-dataview-loading-overlay {
        position: absolute;
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 2;
    }
`;var ut=["list"],gt=["grid"],ft=["header"],ht=["emptymessage"],_t=["footer"],wt=["paginatorleft"],vt=["paginatorright"],yt=["paginatordropdownitem"],bt=["loadingicon"],Ct=["listicon"],xt=["gridicon"],Tt=[[["p-header"]],[["p-footer"]]],St=["p-header","p-footer"],Pt=()=>({position:"top"}),nt=t=>({$implicit:t}),Lt=()=>({position:"bottom"});function Ft(t,o){if(t&1&&S(0,"i"),t&2){let e=l(2);x(e.cn(e.cx("loadingIcon"),"pi-spin"+e.loadingIcon))}}function Dt(t,o){}function Vt(t,o){t&1&&g(0,Dt,0,0,"ng-template")}function kt(t,o){if(t&1&&(I(0),ve(),S(1,"svg",3),g(2,Vt,1,0,null,4),R()),t&2){let e=l(2);s(),x(e.cx("loadingIcon")),p("spin",!0),s(),p("ngTemplateOutlet",e.loadingicon)}}function Mt(t,o){if(t&1&&(d(0,"div")(1,"div"),y(2,Ft,1,2,"i",1)(3,kt,3,4,"ng-container"),c()()),t&2){let e=l();x(e.cx("loading")),s(),x(e.cx("loadingOverlay")),s(),b(e.loadingIcon?2:3)}}function Bt(t,o){t&1&&k(0)}function It(t,o){if(t&1&&(d(0,"div"),ne(1),g(2,Bt,1,0,"ng-container",4),c()),t&2){let e=l();x(e.cx("header")),s(2),p("ngTemplateOutlet",e.headerTemplate)}}function Rt(t,o){if(t&1){let e=C();d(0,"p-paginator",5),v("onPageChange",function(i){m(e);let r=l();return u(r.paginate(i))}),c()}if(t&2){let e=l();p("rows",e.rows)("first",e.first)("totalRecords",e.totalRecords)("pageLinkSize",e.pageLinks)("alwaysShow",e.alwaysShowPaginator)("rowsPerPageOptions",e.rowsPerPageOptions)("appendTo",e.paginatorDropdownAppendTo)("dropdownScrollHeight",e.paginatorDropdownScrollHeight)("templateLeft",e.paginatorleft)("templateRight",e.paginatorright)("currentPageReportTemplate",e.currentPageReportTemplate)("showFirstLastIcon",e.showFirstLastIcon)("dropdownItemTemplate",e.paginatordropdownitem)("showCurrentPageReport",e.showCurrentPageReport)("showJumpToPageDropdown",e.showJumpToPageDropdown)("showPageLinks",e.showPageLinks)("styleClass",e.cn(e.cx("pcPaginator",O(17,Pt)),e.paginatorStyleClass))}}function Ot(t,o){t&1&&k(0)}function Et(t,o){if(t&1&&(g(0,Ot,1,0,"ng-container",6),L(1,"slice")),t&2){let e=l();p("ngTemplateOutlet",e.listTemplate)("ngTemplateOutletContext",E(6,nt,e.paginator?se(1,2,e.filteredValue||e.value,e.lazy?0:e.first,(e.lazy?0:e.first)+e.rows):e.filteredValue||e.value))}}function zt(t,o){t&1&&k(0)}function jt(t,o){if(t&1&&(g(0,zt,1,0,"ng-container",6),L(1,"slice")),t&2){let e=l();p("ngTemplateOutlet",e.gridTemplate)("ngTemplateOutletContext",E(6,nt,e.paginator?se(1,2,e.filteredValue||e.value,e.lazy?0:e.first,(e.lazy?0:e.first)+e.rows):e.filteredValue||e.value))}}function Ut(t,o){if(t&1&&(I(0),w(1),R()),t&2){let e=l(2);s(),P(" ",e.emptyMessageLabel," ")}}function Nt(t,o){t&1&&k(0,null,0)}function Ht(t,o){if(t&1&&(d(0,"div"),g(1,Ut,2,1,"ng-container",7)(2,Nt,2,0,"ng-container",4),c()),t&2){let e=l();x(e.cx("emptyMessage")),s(),p("ngIf",!e.emptymessageTemplate)("ngIfElse",e.empty),s(),p("ngTemplateOutlet",e.emptymessageTemplate)}}function Qt(t,o){if(t&1){let e=C();d(0,"p-paginator",5),v("onPageChange",function(i){m(e);let r=l();return u(r.paginate(i))}),c()}if(t&2){let e=l();p("rows",e.rows)("first",e.first)("totalRecords",e.totalRecords)("pageLinkSize",e.pageLinks)("alwaysShow",e.alwaysShowPaginator)("rowsPerPageOptions",e.rowsPerPageOptions)("appendTo",e.paginatorDropdownAppendTo)("dropdownScrollHeight",e.paginatorDropdownScrollHeight)("templateLeft",e.paginatorleft)("templateRight",e.paginatorright)("currentPageReportTemplate",e.currentPageReportTemplate)("showFirstLastIcon",e.showFirstLastIcon)("dropdownItemTemplate",e.paginatordropdownitem)("showCurrentPageReport",e.showCurrentPageReport)("showJumpToPageDropdown",e.showJumpToPageDropdown)("showPageLinks",e.showPageLinks)("styleClass",e.cn(e.cx("pcPaginator",O(17,Lt)),e.paginatorStyleClass))}}function Yt(t,o){t&1&&k(0)}function At(t,o){if(t&1&&(d(0,"div"),ne(1,1),g(2,Yt,1,0,"ng-container",4),c()),t&2){let e=l();x(e.cx("footer")),s(2),p("ngTemplateOutlet",e.footerTemplate)}}var qt={root:({instance:t})=>["p-dataview p-component",{"p-dataview-list":t.layout==="list","p-dataview-grid":t.layout==="grid"}],header:"p-dataview-header",loading:"p-dataview-loading",loadingOverlay:"p-dataview-loading-overlay p-overlay-mask",loadingIcon:"p-dataview-loading-icon",pcPaginator:({position:t})=>"p-dataview-paginator-"+t,content:"p-dataview-content",emptyMessage:"p-dataview-empty-message",footer:"p-dataview-footer"},ot=(()=>{class t extends je{name="dataview";theme=it;classes=qt;static \u0275fac=(()=>{let e;return function(i){return(e||(e=oe(t)))(i||t)}})();static \u0275prov=F({token:t,factory:t.\u0275fac})}return t})();var pe=(()=>{class t extends Qe{paginator;rows;totalRecords;pageLinks=5;rowsPerPageOptions;paginatorPosition="bottom";paginatorStyleClass;alwaysShowPaginator=!0;paginatorDropdownAppendTo;paginatorDropdownScrollHeight="200px";currentPageReportTemplate="{currentPage} of {totalPages}";showCurrentPageReport;showJumpToPageDropdown;showFirstLastIcon=!0;showPageLinks=!0;lazy;lazyLoadOnInit=!0;emptyMessage="";styleClass;gridStyleClass="";trackBy=(e,n)=>n;filterBy;filterLocale;loading;loadingIcon;first=0;sortField;sortOrder;value;layout="list";onLazyLoad=new B;onPage=new B;onSort=new B;onChangeLayout=new B;listTemplate;gridTemplate;headerTemplate;emptymessageTemplate;footerTemplate;paginatorleft;paginatorright;paginatordropdownitem;loadingicon;listicon;gridicon;header;footer;_value;filteredValue;filterValue;initialized;_layout="list";translationSubscription;_componentStyle=D(ot);get emptyMessageLabel(){return this.emptyMessage||this.config.getTranslation(ze.EMPTY_MESSAGE)}filterService=D(Ie);ngOnInit(){super.ngOnInit(),this.lazy&&this.lazyLoadOnInit&&this.onLazyLoad.emit(this.createLazyLoadMetadata()),this.translationSubscription=this.config.translationObserver.subscribe(()=>{this.cd.markForCheck()}),this.initialized=!0}ngAfterViewInit(){super.ngAfterViewInit()}ngOnChanges(e){super.ngOnChanges(e),e.layout&&!e.layout.firstChange&&this.onChangeLayout.emit({layout:e.layout.currentValue}),e.value&&(this._value=e.value.currentValue,this.updateTotalRecords(),!this.lazy&&this.hasFilter()&&this.filter(this.filterValue)),(e.sortField||e.sortOrder)&&(!this.lazy||this.initialized)&&this.sort()}updateTotalRecords(){this.totalRecords=this.lazy?this.totalRecords:this._value?this._value.length:0}paginate(e){this.first=e.first,this.rows=e.rows,this.lazy&&this.onLazyLoad.emit(this.createLazyLoadMetadata()),this.onPage.emit({first:this.first,rows:this.rows})}sort(){this.first=0,this.lazy?this.onLazyLoad.emit(this.createLazyLoadMetadata()):this.value&&(this.value.sort((e,n)=>{let i=de(e,this.sortField),r=de(n,this.sortField),a=null;return i==null&&r!=null?a=-1:i!=null&&r==null?a=1:i==null&&r==null?a=0:typeof i=="string"&&typeof r=="string"?a=i.localeCompare(r):a=i<r?-1:i>r?1:0,this.sortOrder*a}),this.hasFilter()&&this.filter(this.filterValue)),this.onSort.emit({sortField:this.sortField,sortOrder:this.sortOrder})}isEmpty(){let e=this.filteredValue||this.value;return e==null||e.length==0}createLazyLoadMetadata(){return{first:this.first,rows:this.rows,sortField:this.sortField,sortOrder:this.sortOrder}}getBlockableElement(){return this.el.nativeElement.children[0]}filter(e,n="contains"){if(this.filterValue=e,this.value&&this.value.length){let i=this.filterBy.split(",");this.filteredValue=this.filterService.filter(this.value,i,e,n,this.filterLocale),this.filteredValue.length===this.value.length&&(this.filteredValue=null),this.paginator&&(this.first=0,this.totalRecords=this.filteredValue?this.filteredValue.length:this.value?this.value.length:0),this.cd.markForCheck()}}hasFilter(){return this.filterValue&&this.filterValue.trim().length>0}ngOnDestroy(){this.translationSubscription&&this.translationSubscription.unsubscribe(),super.ngOnDestroy()}static \u0275fac=(()=>{let e;return function(i){return(e||(e=oe(t)))(i||t)}})();static \u0275cmp=U({type:t,selectors:[["p-dataView"],["p-dataview"],["p-data-view"]],contentQueries:function(n,i,r){if(n&1&&(f(r,ut,5),f(r,gt,5),f(r,ft,5),f(r,ht,5),f(r,_t,5),f(r,wt,5),f(r,vt,5),f(r,yt,5),f(r,bt,5),f(r,Ct,5),f(r,xt,5),f(r,Re,5),f(r,Oe,5)),n&2){let a;h(a=_())&&(i.listTemplate=a.first),h(a=_())&&(i.gridTemplate=a.first),h(a=_())&&(i.headerTemplate=a.first),h(a=_())&&(i.emptymessageTemplate=a.first),h(a=_())&&(i.footerTemplate=a.first),h(a=_())&&(i.paginatorleft=a.first),h(a=_())&&(i.paginatorright=a.first),h(a=_())&&(i.paginatordropdownitem=a.first),h(a=_())&&(i.loadingicon=a.first),h(a=_())&&(i.listicon=a.first),h(a=_())&&(i.gridicon=a.first),h(a=_())&&(i.header=a.first),h(a=_())&&(i.footer=a.first)}},hostVars:2,hostBindings:function(n,i){n&2&&x(i.cn(i.cx("root"),i.styleClass))},inputs:{paginator:[2,"paginator","paginator",T],rows:[2,"rows","rows",M],totalRecords:[2,"totalRecords","totalRecords",M],pageLinks:[2,"pageLinks","pageLinks",M],rowsPerPageOptions:"rowsPerPageOptions",paginatorPosition:"paginatorPosition",paginatorStyleClass:"paginatorStyleClass",alwaysShowPaginator:[2,"alwaysShowPaginator","alwaysShowPaginator",T],paginatorDropdownAppendTo:"paginatorDropdownAppendTo",paginatorDropdownScrollHeight:"paginatorDropdownScrollHeight",currentPageReportTemplate:"currentPageReportTemplate",showCurrentPageReport:[2,"showCurrentPageReport","showCurrentPageReport",T],showJumpToPageDropdown:[2,"showJumpToPageDropdown","showJumpToPageDropdown",T],showFirstLastIcon:[2,"showFirstLastIcon","showFirstLastIcon",T],showPageLinks:[2,"showPageLinks","showPageLinks",T],lazy:[2,"lazy","lazy",T],lazyLoadOnInit:[2,"lazyLoadOnInit","lazyLoadOnInit",T],emptyMessage:"emptyMessage",styleClass:"styleClass",gridStyleClass:"gridStyleClass",trackBy:"trackBy",filterBy:"filterBy",filterLocale:"filterLocale",loading:[2,"loading","loading",T],loadingIcon:"loadingIcon",first:[2,"first","first",M],sortField:"sortField",sortOrder:[2,"sortOrder","sortOrder",M],value:"value",layout:"layout"},outputs:{onLazyLoad:"onLazyLoad",onPage:"onPage",onSort:"onSort",onChangeLayout:"onChangeLayout"},features:[Y([ot]),Ce,ye],ngContentSelectors:St,decls:9,vars:10,consts:[["empty",""],[3,"class"],[3,"rows","first","totalRecords","pageLinkSize","alwaysShow","rowsPerPageOptions","appendTo","dropdownScrollHeight","templateLeft","templateRight","currentPageReportTemplate","showFirstLastIcon","dropdownItemTemplate","showCurrentPageReport","showJumpToPageDropdown","showPageLinks","styleClass"],["data-p-icon","spinner",3,"spin"],[4,"ngTemplateOutlet"],[3,"onPageChange","rows","first","totalRecords","pageLinkSize","alwaysShow","rowsPerPageOptions","appendTo","dropdownScrollHeight","templateLeft","templateRight","currentPageReportTemplate","showFirstLastIcon","dropdownItemTemplate","showCurrentPageReport","showJumpToPageDropdown","showPageLinks","styleClass"],[4,"ngTemplateOutlet","ngTemplateOutletContext"],[4,"ngIf","ngIfElse"]],template:function(n,i){n&1&&(xe(Tt),y(0,Mt,4,5,"div",1),y(1,It,3,3,"div",1),y(2,Rt,1,18,"p-paginator",2),d(3,"div"),y(4,Et,2,8,"ng-container"),y(5,jt,2,8,"ng-container"),y(6,Ht,3,5,"div",1),c(),y(7,Qt,1,18,"p-paginator",2),y(8,At,3,3,"div",1)),n&2&&(b(i.loading?0:-1),s(),b(i.header||i.headerTemplate?1:-1),s(),b(i.paginator&&(i.paginatorPosition==="top"||i.paginatorPosition=="both")?2:-1),s(),x(i.cx("content")),s(),b(i.layout==="list"?4:-1),s(),b(i.layout==="grid"?5:-1),s(),b(i.isEmpty()&&!i.loading?6:-1),s(),b(i.paginator&&(i.paginatorPosition==="bottom"||i.paginatorPosition=="both")?7:-1),s(),b(i.footer||i.footerTemplate?8:-1))},dependencies:[q,A,Fe,Xe,Ke,Ye,W,ke],encapsulation:2,changeDetection:0})}return t})(),rt=(()=>{class t{static \u0275fac=function(n){return new(n||t)};static \u0275mod=be({type:t});static \u0275inj=we({imports:[pe,W,W]})}return t})();var st=ct(pt());var X=class t{apiUrl=`${K.BASE_URL}/empleado/mis-documentos`;http=D($);tokenService=D(G);getAuthHeaders(){let o=this.tokenService.getToken();return new z({Authorization:`Bearer ${o}`,Accept:"application/json"})}getToken(){let o=localStorage.getItem("authToken");if(o)return o;let e=localStorage.getItem("user");if(e)try{let n=JSON.parse(e);return n?.token||n?.access_token||null}catch{return null}return null}getMyDocuments(){let o=this.getToken(),e=new z(ge({accept:"application/json"},o?{Authorization:`Bearer ${o}`}:{}));return this.http.get(`${this.apiUrl}`,{headers:e}).pipe(_e(n=>(console.error("Error al obtener documentos",n),he(()=>n))))}static \u0275fac=function(e){return new(e||t)};static \u0275prov=F({token:t,factory:t.\u0275fac,providedIn:"root"})};var Z=class t{constructor(o,e){this.http=o;this.tokenSrv=e}apiUrl=`${K.BASE_URL}/empleado/verificar-firma`;authHeaders(){let o=new z({Accept:"application/json"}),e=this.tokenSrv.getToken();return e&&(o=o.set("Authorization",`Bearer ${e}`)),o}verificarFirma(o){return this.http.get(`${this.apiUrl}/${o}`,{headers:this.authHeaders()})}static \u0275fac=function(e){return new(e||t)(ie($),ie(G))};static \u0275prov=F({token:t,factory:t.\u0275fac,providedIn:"root"})};var Gt=()=>[5,10,25,50],Kt=t=>({"border-t border-surface":t});function Xt(t,o){if(t&1){let e=C();d(0,"p-button",10),v("click",function(){m(e);let i=l();return u(i.goBackToYears())}),c()}}function Zt(t,o){if(t&1){let e=C();d(0,"p-button",10),v("click",function(){m(e);let i=l();return u(i.home())}),c()}}function ei(t,o){if(t&1){let e=C();d(0,"div",13),v("click",function(){let i=m(e).$implicit,r=l(2);return u(r.selectYear(i))}),S(1,"i",14),d(2,"span",15),w(3),c()()}if(t&2){let e=o.$implicit;s(3),re(e)}}function ti(t,o){if(t&1&&(d(0,"div",11),g(1,ei,4,1,"div",12),c()),t&2){let e=l();s(),p("ngForOf",e.years)}}function ii(t,o){if(t&1){let e=C();I(0),d(1,"p-button",37),v("onClick",function(){m(e);let i=l().$implicit,r=l(3);return u(r.verDocumento(i))}),c(),R()}}function oi(t,o){if(t&1){let e=C();d(0,"p-button",38),v("onClick",function(){m(e);let i=l().$implicit,r=l(3);return u(r.descargar(i))}),c()}if(t&2){let e=l().$implicit,n=l(3);p("icon",n.validando[e.id]?"pi pi-spin pi-spinner":"pi pi-pencil")("label",n.validando[e.id]?"Validando...":"Firmar")("disabled",n.validando[e.id])}}function ni(t,o){if(t&1&&(d(0,"div",29)(1,"div",30),w(2),c(),d(3,"div",31),w(4),c(),d(5,"div",32),w(6),L(7,"date"),c(),d(8,"div",32),w(9),L(10,"date"),c(),d(11,"div",33),S(12,"p-tag",34),L(13,"titlecase"),S(14,"span",35),g(15,ii,2,0,"ng-container",36)(16,oi,1,3,"ng-template",null,1,le),c()()),t&2){let e=o.$implicit,n=o.index,i=Te(17),r=l(3);p("ngClass",E(17,Kt,n!==0)),s(2),P(" ",e.nombre_archivo," "),s(2),P("Usuario: ",e.nombre_usuario),s(2),P("Subido: ",ae(7,9,e.subido_en,"medium")),s(3),P(" Firmado: ",e.firmado_en?ae(10,12,e.firmado_en,"medium"):"\u2014"," "),s(3),p("value",Se(13,15,e.estado))("severity",r.getSeverity(e.estado)),s(3),p("ngIf",e.estado==="firmado")("ngIfElse",i)}}function ri(t,o){if(t&1&&(d(0,"div",2),g(1,ni,18,19,"div",28),c()),t&2){let e=o.$implicit,n=l(2);s(),p("ngForOf",e)("ngForTrackBy",n.trackDoc)}}function ai(t,o){t&1&&(d(0,"div",39),w(1,"No hay facturas."),c())}function si(t,o){if(t&1&&(d(0,"div",40),w(1),c()),t&2){let e=l(2);s(),re(e.error)}}function li(t,o){if(t&1){let e=C();d(0,"div")(1,"div",16)(2,"div",2)(3,"label",17),w(4,"Estado"),c(),d(5,"p-select",18),Q("ngModelChange",function(i){m(e);let r=l();return H(r.estadoFiltro,i)||(r.estadoFiltro=i),u(i)}),v("onChange",function(){m(e);let i=l();return u(i.aplicarFiltros())}),c()(),d(6,"div",2)(7,"label",17),w(8,"Mes"),c(),d(9,"p-select",19),Q("ngModelChange",function(i){m(e);let r=l();return H(r.mesFiltro,i)||(r.mesFiltro=i),u(i)}),v("onChange",function(){m(e);let i=l();return u(i.aplicarFiltros())}),c()(),d(10,"div",20)(11,"div",21)(12,"label",17),w(13,"Ordenar por"),c(),d(14,"p-select",22),Q("ngModelChange",function(i){m(e);let r=l();return H(r.ordenarPor,i)||(r.ordenarPor=i),u(i)}),v("onChange",function(){m(e);let i=l();return u(i.aplicarFiltros())}),c()(),d(15,"div",23)(16,"button",24),v("click",function(){m(e);let i=l();return u(i.limpiarFiltros())}),c()()()(),d(17,"p-dataview",25),g(18,ri,2,2,"ng-template",null,0,le)(20,ai,2,0,"ng-template",26),c(),g(21,si,2,1,"div",27),c()}if(t&2){let e=l();s(5),p("options",e.estadoOptions),N("ngModel",e.estadoFiltro),p("showClear",!0),s(4),p("options",e.meses),N("ngModel",e.mesFiltro),p("showClear",!0),s(5),p("options",e.opcionesOrden),N("ngModel",e.ordenarPor),s(3),p("value",e.documentosFiltrados)("paginator",!0)("rows",e.rows)("rowsPerPageOptions",O(15,Gt))("first",e.first)("alwaysShowPaginator",!1),s(4),p("ngIf",e.error)}}var at=class t{constructor(o,e,n,i,r){this.listSvc=o;this.signSts=e;this.router=n;this.route=i;this.messageService=r}years=[];selectedYear=null;showYearView=!0;showDocumentView=!1;loading=!1;error=null;documentos=[];documentosFiltrados=[];validando={};estadoFiltro="all";mesFiltro=null;ordenarPor="recientes";estadoOptions=[{label:"Todos",value:"all"},{label:"Pendiente",value:"pendiente"},{label:"Firmado",value:"firmado"}];opcionesOrden=[{label:"M\xE1s recientes primero",value:"recientes"},{label:"M\xE1s antiguos primero",value:"antiguos"}];meses=[{label:"Enero",value:1},{label:"Febrero",value:2},{label:"Marzo",value:3},{label:"Abril",value:4},{label:"Mayo",value:5},{label:"Junio",value:6},{label:"Julio",value:7},{label:"Agosto",value:8},{label:"Septiembre",value:9},{label:"Octubre",value:10},{label:"Noviembre",value:11},{label:"Diciembre",value:12}];rows=10;first=0;extraerPeriodoDeNombre(o){if(!o)return null;let e=["enero","febrero","marzo","abril","mayo","junio","julio","agosto","septiembre","setiembre","octubre","noviembre","diciembre"],n=te=>te.normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase(),i=n(o),r=new RegExp(`\\b(${e.map(te=>n(te)).join("|")})\\b`,"i"),a=/(19|20)\d{2}/,j=i.match(r),me=i.match(a);if(!j||!me)return null;let ee=j[1];ee==="setiembre"&&(ee="septiembre");let ue=["enero","febrero","marzo","abril","mayo","junio","julio","agosto","septiembre","octubre","noviembre","diciembre"].indexOf(ee);if(ue===-1)return null;let lt=Number(me[0]),dt=ue+1;return{year:lt,month:dt}}getFechaPeriodo(o){let e=this.extraerPeriodoDeNombre(o.nombre_archivo);return e?new Date(e.year,e.month-1,1):null}ngOnInit(){this.route.queryParams.subscribe(o=>{let e=o.year,n=e?Number(e):null;n&&!Number.isNaN(n)?(this.selectedYear=n,this.showYearView=!1,this.showDocumentView=!0):(this.selectedYear=null,this.showYearView=!0,this.showDocumentView=!1),this.aplicarFiltros()}),this.cargar()}cargar(){this.loading=!0,this.error=null,this.listSvc.getMyDocuments().subscribe({next:o=>{this.documentos=o.documentos??[];let e=new Set;this.documentos.forEach(n=>{let i=this.extraerPeriodoDeNombre(n.nombre_archivo);if(i)e.add(i.year);else if(n.subido_en){let r=new Date(n.subido_en).getFullYear();Number.isNaN(r)||e.add(r)}}),this.years=Array.from(e).sort((n,i)=>i-n),this.aplicarFiltros(),this.loading=!1},error:o=>{this.error=o?.error?.detail||"No se pudieron cargar los documentos.",this.documentos=[],this.documentosFiltrados=[],this.years=[],this.loading=!1}})}limpiarFiltros(){this.estadoFiltro="all",this.mesFiltro=null,this.ordenarPor="recientes",this.first=0,this.aplicarFiltros()}aplicarFiltros(){let o=this.documentos.filter(e=>{let n=this.estadoFiltro==="all"||(e.estado||"").toLowerCase()===this.estadoFiltro,i=this.extraerPeriodoDeNombre(e.nombre_archivo),r=!0;this.mesFiltro&&(i?r=i.month===this.mesFiltro:e.subido_en?r=new Date(e.subido_en).getMonth()+1===this.mesFiltro:r=!1);let a=!0;return this.selectedYear&&(i?a=i.year===this.selectedYear:e.subido_en?a=new Date(e.subido_en).getFullYear()===this.selectedYear:a=!1),n&&r&&a});o.sort((e,n)=>{let i=this.getFechaPeriodo(e)?.getTime()??(e.subido_en?new Date(e.subido_en).getTime():0),r=this.getFechaPeriodo(n)?.getTime()??(n.subido_en?new Date(n.subido_en).getTime():0);return this.ordenarPor==="recientes"?r-i:i-r}),this.documentosFiltrados=o}getSeverity(o){let e=(o||"").toLowerCase();return e==="firmado"?"success":e==="pendiente"?"danger":"info"}trackDoc=(o,e)=>e.id;selectYear(o){this.selectedYear=o,this.showYearView=!1,this.showDocumentView=!0,this.aplicarFiltros(),this.router.navigate([],{relativeTo:this.route,queryParams:{year:o},queryParamsHandling:"merge"})}goBackToYears(){this.selectedYear=null,this.showYearView=!0,this.showDocumentView=!1,this.aplicarFiltros(),this.router.navigate([],{relativeTo:this.route,queryParams:{year:null},queryParamsHandling:"merge"})}descargar(o){return fe(this,null,function*(){this.validando[o.id]=!0;try{let e=yield this.signSts.verificarFirma(o.id).toPromise();if(e?.puede_firmar)this.router.navigate(["/signature/sign-ballots",o.id],{state:{doc:o},queryParamsHandling:"preserve"});else{let n=e?.documento_pendiente,i=n?`Tienes el documento "${n.nombre}" (${n.fecha}) pendiente de firmar.`:"Tienes documentos pendientes de firmar.";yield st.default.fire({title:"Documentos pendientes",html:`${i}<br>Por favor, f\xEDrmalos en orden cronol\xF3gico.`,icon:"warning",confirmButtonText:"Entendido",confirmButtonColor:"#3085d6",showCloseButton:!0})}}catch(e){console.error("Error al verificar documentos:",e),this.messageService.add({severity:"error",summary:"Error",detail:"Ocurri\xF3 un error al verificar el estado del documento",life:5e3})}finally{this.validando[o.id]=!1}})}verDocumento(o){this.router.navigate(["/signature/sign-ballots",o.id],{state:{doc:o},queryParamsHandling:"preserve"})}home(){window.location.href="/signature/home"}static \u0275fac=function(e){return new(e||t)(V(X),V(Z),V(Be),V(Me),V(J))};static \u0275cmp=U({type:t,selectors:[["app-list-ballots-user"]],features:[Y([J])],decls:10,vars:6,consts:[["list",""],["firmarButton",""],[1,"flex","flex-col"],["message","Cargando documentos...",3,"isLoading"],[1,"card","relative"],[1,"flex","items-center","mb-3"],["icon","pi pi-arrow-left","styleClass","p-button-danger p-button-rounded p-button-text mr-2",3,"click",4,"ngIf"],[1,"font-semibold","text-xl"],["class","grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6 p-4 justify-center",4,"ngIf"],[4,"ngIf"],["icon","pi pi-arrow-left","styleClass","p-button-danger p-button-rounded p-button-text mr-2",3,"click"],[1,"grid","grid-cols-1","sm:grid-cols-2","md:grid-cols-3","lg:grid-cols-4","gap-6","p-4","justify-center"],["class","p-6 border rounded shadow hover:shadow-md cursor-pointer transition-transform transform hover:-translate-y-1 bg-white flex flex-col items-center",3,"click",4,"ngFor","ngForOf"],[1,"p-6","border","rounded","shadow","hover:shadow-md","cursor-pointer","transition-transform","transform","hover:-translate-y-1","bg-white","flex","flex-col","items-center",3,"click"],[1,"pi","pi-folder","text-5xl","text-primary-500","mb-3"],[1,"font-semibold","text-lg"],[1,"grid","grid-cols-1","md:grid-cols-3","gap-4","mb-4"],[1,"block","text-600","text-sm","font-medium","mb-2"],["optionLabel","label","optionValue","value","placeholder","Filtrar por estado","styleClass","w-full",3,"ngModelChange","onChange","options","ngModel","showClear"],["optionLabel","label","optionValue","value","placeholder","Filtrar por mes","styleClass","w-full",3,"ngModelChange","onChange","options","ngModel","showClear"],[1,"flex","items-end","gap-2"],[1,"flex-1","flex","flex-col"],["optionLabel","label","optionValue","value","styleClass","w-full",3,"ngModelChange","onChange","options","ngModel"],[1,"flex","items-end"],["pButton","","type","button","icon","pi pi-filter-slash","label","Limpiar",1,"p-button-text","p-button-sm",2,"height","36px","margin-bottom","2px",3,"click"],["layout","list","paginatorPosition","both",3,"value","paginator","rows","rowsPerPageOptions","first","alwaysShowPaginator"],["pTemplate","empty"],["class","mt-3 text-red-600",4,"ngIf"],["class","flex flex-col p-6 gap-3",3,"ngClass",4,"ngFor","ngForOf","ngForTrackBy"],[1,"flex","flex-col","p-6","gap-3",3,"ngClass"],[1,"text-lg","font-medium","break-all","text-blue-600"],[1,"mt-1","text-surface-500","text-sm"],[1,"text-surface-500","text-sm"],[1,"mt-2","flex","items-center","gap-3","flex-nowrap"],[1,"shrink-0",3,"value","severity"],[1,"grow"],[4,"ngIf","ngIfElse"],["icon","pi pi-eye","label","Ver","severity","info","raised","","size","small",1,"shrink-0","whitespace-nowrap","px-5","h-9","rounded-md",3,"onClick"],["severity","success","raised","","size","small",1,"shrink-0","whitespace-nowrap","px-5","h-9","rounded-md",3,"onClick","icon","label","disabled"],[1,"p-6","text-center","text-surface-500"],[1,"mt-3","text-red-600"]],template:function(e,n){e&1&&(d(0,"div",2),S(1,"app-loading",3),d(2,"div",4)(3,"div",5),g(4,Xt,1,0,"p-button",6)(5,Zt,1,0,"p-button",6),d(6,"div",7),w(7),c()(),g(8,ti,2,1,"div",8)(9,li,22,16,"div",9),c()()),e&2&&(s(),p("isLoading",n.loading),s(3),p("ngIf",!n.showYearView),s(),p("ngIf",n.showYearView),s(2),P(" ",n.showYearView?"Mis Documentos":"Documentos del a\xF1o "+n.selectedYear," "),s(),p("ngIf",n.showYearView),s(),p("ngIf",n.showDocumentView))},dependencies:[q,Pe,Le,A,He,Ue,Ne,rt,pe,Ee,Ze,tt,et,$e,Ae,qe,Je,Ge,We,De,Ve],encapsulation:2})};export{at as ListBallotsUserComponent};
