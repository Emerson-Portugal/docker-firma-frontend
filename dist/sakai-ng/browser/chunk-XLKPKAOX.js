import{z as l}from"./chunk-ITE25VCI.js";import{L as a}from"./chunk-TKL4FGBT.js";import{f as o}from"./chunk-EQDQRRRY.js";var s=class i{TOKEN_KEY="authToken";EXPIRATION_KEY="expiration";USER_KEY="user";USER_UPDATE_ADVISORDATA="updateAdvisorData";constructor(){}getToken(){return this.isTokenExpired()?(this.clearAll(),null):localStorage.getItem(this.TOKEN_KEY)}setToken(e,t){if(localStorage.setItem(this.TOKEN_KEY,e),t){let r=new Date,n=new Date(r.getTime()+t*1e3);this.setExpiration(n.toISOString())}}removeToken(){localStorage.removeItem(this.TOKEN_KEY)}setExpiration(e){localStorage.setItem(this.EXPIRATION_KEY,e)}getExpiration(){return localStorage.getItem(this.EXPIRATION_KEY)}removeExpiration(){localStorage.removeItem(this.EXPIRATION_KEY)}isTokenExpired(){let e=this.getExpiration();if(!e)return!0;let t=new Date(e);return new Date>=t}checkAndClearExpiredToken(){let e=this.isTokenExpired();return e&&(this.showSessionExpiredAlert(),this.clearAll()),e}showSessionExpiredAlert(){return o(this,null,function*(){try{yield(yield import("./chunk-AXLLW4JI.js")).default.fire({title:"Sesi\xF3n Expirada",text:"Su sesi\xF3n ha expirado. Por favor, inicie sesi\xF3n nuevamente.",icon:"warning",confirmButtonText:"Aceptar",allowOutsideClick:!1,allowEscapeKey:!1,allowEnterKey:!1}),this.clearAll(),window.location.href="/auth/login"}catch(e){console.error("Error al mostrar la alerta de sesi\xF3n expirada:",e),this.clearAll(),window.location.href="/auth/login"}})}setUser(e){localStorage.setItem(this.USER_KEY,JSON.stringify(e))}getUser(){if(this.isTokenExpired())return this.clearAll(),null;let e=localStorage.getItem(this.USER_KEY);return e?JSON.parse(e):null}removeUser(){localStorage.removeItem(this.USER_KEY),localStorage.removeItem(this.USER_UPDATE_ADVISORDATA)}getAuthHeaders(){let e=this.getToken();return new l({"Content-Type":"application/json",Authorization:e?`Bearer ${e}`:""})}clearAll(){this.removeToken(),this.removeExpiration(),this.removeUser()}getRole(){let e=this.getUser();if(e?.rol)return String(e.rol).toLowerCase();if(e?.role)return String(e.role).toLowerCase();if(Array.isArray(e?.roles)&&e.roles.length)return String(e.roles[0]).toLowerCase();let t=this.getToken();if(!t)return null;let r=this.decodeJwt(t);return r?r.rol?String(r.rol).toLowerCase():r.role?String(r.role).toLowerCase():Array.isArray(r.roles)&&r.roles.length?String(r.roles[0]).toLowerCase():null:null}hasRole(e){let t=Array.isArray(e)?e:[e],r=this.getRole();return r?t.map(n=>n.toLowerCase()).includes(r):!1}decodeJwt(e){try{let t=e.split(".")[1];if(!t)return null;let r=t.replace(/-/g,"+").replace(/_/g,"/"),n=decodeURIComponent(atob(r).split("").map(u=>`%${("00"+u.charCodeAt(0).toString(16)).slice(-2)}`).join(""));return JSON.parse(n)}catch{return null}}getFullName(){let e=this.getUser();if(e?.full_name)return String(e.full_name);if(e?.nombre)return String(e.nombre);if(e?.name)return String(e.name);if(e?.email)return String(e.email);let t=this.getJwtPayload();return t?.full_name?String(t.full_name):t?.name?String(t.name):t?.email?String(t.email):null}getDni(){let e=this.getUser();if(e?.dni)return String(e.dni);let t=this.getJwtPayload();return t?.dni?String(t.dni):t?.sub?String(t.sub):null}getJwtPayload(){let e=this.getToken();return e?this.decodeJwt(e):null}static \u0275fac=function(t){return new(t||i)};static \u0275prov=a({token:i,factory:i.\u0275fac,providedIn:"root"})};export{s as a};
