import{a as oe,b as ne}from"./chunk-KJEGAV32.js";import{d as X,e as Y,f as te,g as ie}from"./chunk-2VIMMKOP.js";import"./chunk-RSM7VBVG.js";import{a as Q,b as W}from"./chunk-DX5THWTO.js";import{a as Z,b as ee}from"./chunk-Q5BYMEUU.js";import"./chunk-F6ZR5WI3.js";import{b as G,p as q,q as J,r as K}from"./chunk-RS23IZFS.js";import{Y as U,aa as L}from"./chunk-OUHVS6X7.js";import"./chunk-TBYF2LDC.js";import{a as O}from"./chunk-XLKPKAOX.js";import{B as N,D as z,i as A,l as j,q as H,s as D,z as $}from"./chunk-ITE25VCI.js";import{Aa as T,Ab as f,Bb as m,Ga as r,Kb as P,L as B,Nb as R,Pb as l,Q as b,Qb as x,Rb as C,Ta as I,V as v,W as h,Wb as k,X as S,Xb as u,Za as c,_b as E,ec as M,fc as V,mb as p,nb as i,ob as n,pb as g,wb as y}from"./chunk-TKL4FGBT.js";import"./chunk-EQDQRRRY.js";var w=class t{apiUrl=`${G.BASE_URL}/rrhh/rrhh/documentos/upload/lote`;http=b(z);tokenService=b(O);getAuthHeaders(){let o=this.tokenService.getToken();return new $({Authorization:`Bearer ${o}`,Accept:"application/json"})}uploadBallots(o){let e=new FormData;o.forEach(s=>e.append("files",s));let a=this.getAuthHeaders();return this.http.post(this.apiUrl,e,{headers:a,reportProgress:!0,observe:"events"})}static \u0275fac=function(e){return new(e||t)};static \u0275prov=B({token:t,factory:t.\u0275fac,providedIn:"root"})};var se=()=>({"margin-bottom":"2em"}),F=()=>[5,10,25,50],pe=()=>({"min-width":"50rem"}),de=()=>({"margin-top":"2em"}),ce=(t,o,e)=>({"border-green-500 bg-green-50":t,"border-yellow-500 bg-yellow-50":o,"border-red-500 bg-red-50":e}),me=(t,o,e)=>({"text-green-800":t,"text-yellow-800":o,"text-red-800":e}),ae=()=>({"min-width":"100%"});function ue(t,o){if(t&1){let e=y();i(0,"div",14)(1,"p-button",15),f("click",function(){v(e);let s=m();return h(s.home())}),n(),i(2,"span",16),l(3,"Carga de Boletas de Pago"),n()()}}function _e(t,o){t&1&&(i(0,"tr")(1,"th"),l(2,"Nombre del archivo"),n(),i(3,"th"),l(4,"Tama\xF1o"),n(),i(5,"th"),l(6,"Acciones"),n()())}function ge(t,o){if(t&1){let e=y();i(0,"tr")(1,"td"),l(2),n(),i(3,"td"),l(4),M(5,"number"),n(),i(6,"td")(7,"button",21),f("click",function(){let s=v(e).rowIndex,d=m(2);return h(d.removeFile(s))}),n()()()}if(t&2){let e=o.$implicit,a=m(2);r(2),x(e.name),r(2),C("",V(5,3,e.size)," bytes"),r(3),p("disabled",a.isUploading)}}function ve(t,o){if(t&1&&(i(0,"div",17)(1,"h4",18),l(2,"Archivos seleccionados:"),n(),i(3,"p-table",19),c(4,_e,7,0,"ng-template",2)(5,ge,8,5,"ng-template",20),n()()),t&2){let e=m();r(3),p("value",e.selectedFiles)("scrollable",!0)("rows",5)("paginator",!0)("showCurrentPageReport",!0)("rowsPerPageOptions",u(7,F))("tableStyle",u(8,pe))}}function he(t,o){if(t&1&&(i(0,"div",17),g(1,"p-progressBar",22),i(2,"div",23),l(3),n()()),t&2){let e=m();r(),p("value",e.uploadProgress)("showValue",!0),r(2),C("",e.uploadProgress,"% completado")}}function fe(t,o){t&1&&(i(0,"i",32),S(),i(1,"svg",33),g(2,"path",34),n()())}function xe(t,o){t&1&&(i(0,"i",35),S(),i(1,"svg",33),g(2,"path",36),n()())}function be(t,o){t&1&&(i(0,"i",37),S(),i(1,"svg",33),g(2,"path",38),n()())}function Se(t,o){t&1&&(i(0,"tr")(1,"th"),l(2,"Archivo"),n(),i(3,"th"),l(4,"DNI"),n(),i(5,"th"),l(6,"Error"),n()())}function ye(t,o){if(t&1&&(i(0,"tr")(1,"td"),l(2),n(),i(3,"td"),l(4),n(),i(5,"td",40),l(6),n()()),t&2){let e=o.$implicit;r(2),x(e.archivo),r(2),x(e.dni),r(2),x(e.error)}}function Ce(t,o){if(t&1&&(i(0,"div",17)(1,"h4",39),l(2,"Errores encontrados:"),n(),i(3,"p-table",19),c(4,Se,7,0,"ng-template",2)(5,ye,7,3,"ng-template",20),n()()),t&2){let e=m(2);r(3),p("value",e.uploadResponse.errores)("scrollable",!0)("rows",5)("paginator",!0)("showCurrentPageReport",!0)("rowsPerPageOptions",u(7,F))("tableStyle",u(8,ae))}}function we(t,o){t&1&&(i(0,"tr")(1,"th"),l(2,"Archivo"),n(),i(3,"th"),l(4,"DNI"),n(),i(5,"th"),l(6,"Estado"),n()())}function Re(t,o){if(t&1&&(i(0,"tr")(1,"td"),l(2),n(),i(3,"td"),l(4),n(),i(5,"td"),g(6,"p-tag",41),n()()),t&2){let e=o.$implicit;r(2),x(e.archivo_original),r(2),x(e.dni),r(2),p("severity",e.estado==="subido"?"success":"warning")("value",e.estado==="subido"?"Subido":"Pendiente")}}function Ee(t,o){if(t&1&&(i(0,"div")(1,"h4",39),l(2,"Archivos subidos correctamente:"),n(),i(3,"p-table",19),c(4,we,7,0,"ng-template",2)(5,Re,7,4,"ng-template",20),n()()),t&2){let e=m(2);r(3),p("value",e.uploadResponse.resultados)("scrollable",!0)("rows",5)("paginator",!0)("showCurrentPageReport",!0)("rowsPerPageOptions",u(7,F))("tableStyle",u(8,ae))}}function Ue(t,o){if(t&1&&(i(0,"p-card",24)(1,"div",25)(2,"div",26),c(3,fe,3,0,"i",27)(4,xe,3,0,"i",28)(5,be,3,0,"i",29),i(6,"div"),g(7,"p",30),n()()(),c(8,Ce,6,9,"div",9)(9,Ee,6,9,"div",31),n()),t&2){let e=m();R(u(10,de)),r(),p("ngClass",E(11,ce,e.uploadResponse.archivos_con_error===0,e.uploadResponse.archivos_con_error>0&&e.uploadResponse.archivos_exitosos>0,e.uploadResponse.archivos_exitosos===0&&e.uploadResponse.archivos_con_error>0)),r(2),p("ngIf",e.uploadResponse.archivos_con_error===0),r(),p("ngIf",e.uploadResponse.archivos_con_error>0&&e.uploadResponse.archivos_exitosos>0),r(),p("ngIf",e.uploadResponse.archivos_exitosos===0&&e.uploadResponse.archivos_con_error>0),r(2),p("ngClass",E(15,me,e.uploadResponse.archivos_con_error===0,e.uploadResponse.archivos_con_error>0&&e.uploadResponse.archivos_exitosos>0,e.uploadResponse.archivos_exitosos===0&&e.uploadResponse.archivos_con_error>0))("innerHTML",e.getUploadResultMessage(),T),r(),p("ngIf",e.uploadResponse.errores&&e.uploadResponse.errores.length>0),r(),p("ngIf",e.uploadResponse.resultados&&e.uploadResponse.resultados.length>0)}}var re=class t{uploadService=b(w);messageService=b(U);selectedFiles=[];uploadProgress=0;isUploading=!1;uploadComplete=!1;uploadResponse=null;errorMessage="";onFileSelected(o){let e=Array.from(o.target.files||[]),a=e.filter(s=>!this.selectedFiles.some(d=>d.name===s.name&&d.size===s.size));if(this.selectedFiles=[...this.selectedFiles,...a],o.target.value="",e.length>a.length){let s=e.length-a.length;this.messageService.add({severity:"warn",summary:"Archivos duplicados",detail:`Se omitieron ${s} archivo(s) duplicado(s).`,life:3e3})}}uploadFiles(){if(this.selectedFiles.length===0){this.messageService.add({severity:"warn",summary:"Advertencia",detail:"Por favor selecciona al menos un archivo",life:3e3});return}this.isUploading=!0,this.uploadProgress=0,this.uploadResponse=null;let o=setInterval(()=>{this.uploadProgress<95&&(this.uploadProgress+=5)},150);this.uploadService.uploadBallots(this.selectedFiles).subscribe({next:e=>{if(e.type===N.Response){clearInterval(o),this.uploadProgress=100,this.uploadResponse=e.body;let a=this.uploadResponse?.archivos_exitosos??0,s=this.uploadResponse?.archivos_con_error??0,d,_;s===0?(d="success",_="\xC9xito"):a>0?(d="warn",_="Advertencia"):(d="error",_="Error"),this.messageService.add({severity:d,summary:_,detail:this.getUploadResultMessage(),life:6e3}),setTimeout(()=>{this.isUploading=!1,this.uploadProgress=0},1500)}},error:e=>{clearInterval(o),this.uploadProgress=0,this.isUploading=!1,this.messageService.add({severity:"error",summary:"Error",detail:e.error?.message||"Error al subir archivos",life:6e3})}})}removeFile(o){this.selectedFiles.splice(o,1)}resetForm(){this.selectedFiles=[],this.uploadProgress=0,this.uploadComplete=!1,this.uploadResponse=null,this.errorMessage=""}getUploadResultMessage(){if(!this.uploadResponse)return"";let o=this.uploadResponse.archivos_exitosos??0,e=this.uploadResponse.archivos_con_error??0,a=o+e,s="Procesamiento de archivos completado";return o>0&&(s+=`
${o} de ${a} archivo(s) subidos correctamente`),e>0?(o>0&&(s+=". "),s+=`
${e} archivo(s) con errores.`):s+=".",s}home(){window.location.href="/signature/home"}static \u0275fac=function(e){return new(e||t)};static \u0275cmp=I({type:t,selectors:[["app-upload-ballots"]],features:[k([U])],decls:19,vars:13,consts:[["fileInput",""],[1,"p-4"],["pTemplate","header"],[1,"mb-4","flex","flex-col","items-center","justify-center","text-center"],[1,"block","text-900","font-medium","mb-2"],[1,"flex","items-center","justify-center"],["type","file","id","fileInput","multiple","","accept",".pdf",1,"hidden",3,"change","disabled"],["label","Seleccionar archivos","icon","pi pi-upload","styleClass","p-button-outlined",3,"click","disabled"],[1,"ml-3","text-600"],["class","mb-4",4,"ngIf"],[1,"flex","justify-end","w-full","gap-2"],["pButton","","type","button","label","Cancelar","icon","pi pi-times",1,"p-button-danger","p-button-text",3,"click","disabled"],["pButton","","type","button","icon","pi pi-upload",1,"p-button-success",3,"click","label","disabled","loading"],["header","Resultados",3,"style",4,"ngIf"],[1,"flex","items-center"],["icon","pi pi-arrow-left","styleClass","p-button-danger p-button-rounded p-button-text mr-0",3,"click"],[1,"text-lg","font-semibold"],[1,"mb-4"],[1,"text-900","font-medium"],["scrollHeight","200px","currentPageReportTemplate","Mostrando {first} a {last} de {totalRecords} entradas",3,"value","scrollable","rows","paginator","showCurrentPageReport","rowsPerPageOptions","tableStyle"],["pTemplate","body"],["pButton","","pRipple","","type","button","icon","pi pi-trash",1,"p-button-rounded","p-button-text","p-button-danger",3,"click","disabled"],["styleClass","h-4",3,"value","showValue"],[1,"text-right","text-sm","text-gray-600","mt-1"],["header","Resultados"],[1,"mb-4","p-3","border-round","border-1","align-middle",3,"ngClass"],[1,"flex","align-items-center"],["class","text-2xl mr-1 align-middle text-green-500",4,"ngIf"],["class","text-2xl mr-1 align-middle text-yellow-500",4,"ngIf"],["class","text-2xl mr-1 align-middle text-red-500",4,"ngIf"],[1,"m-0","font-medium","align-middle",3,"ngClass","innerHTML"],[4,"ngIf"],[1,"text-2xl","mr-1","align-middle","text-green-500"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24","stroke","currentColor","stroke-width","2",1,"w-6","h-6"],["stroke-linecap","round","stroke-linejoin","round","d",`M9 12l2 2 4-4m6 2a9 9 0 11-18 
                               0 9 9 0 0118 0z`],[1,"text-2xl","mr-1","align-middle","text-yellow-500"],["stroke-linecap","round","stroke-linejoin","round","d",`M12 9v2m0 4h.01M5.07 
                               19h13.86c1.54 0 2.5-1.67 
                               1.73-3L13.73 4a2 2 0 
                               00-3.46 0L3.34 16c-.77 
                               1.33.19 3 1.73 3z`],[1,"text-2xl","mr-1","align-middle","text-red-500"],["stroke-linecap","round","stroke-linejoin","round","d","M6 18L18 6M6 6l12 12"],[1,"text-900","font-medium","mb-2"],[1,"text-red-600"],["styleClass","p-tag-rounded",3,"severity","value"]],template:function(e,a){if(e&1){let s=y();i(0,"div",1),g(1,"p-toast"),i(2,"p-card"),c(3,ue,4,0,"ng-template",2),i(4,"div",3)(5,"label",4),l(6," Seleccionar archivos PDF de boletas "),n(),i(7,"div",5)(8,"input",6,0),f("change",function(_){return v(s),h(a.onFileSelected(_))}),n(),i(10,"p-button",7),f("click",function(){v(s);let _=P(9);return h(_.click())}),n(),i(11,"span",8),l(12),n()()(),c(13,ve,6,9,"div",9)(14,he,4,3,"div",9),i(15,"div",10)(16,"button",11),f("click",function(){return v(s),h(a.resetForm())}),n(),i(17,"button",12),f("click",function(){return v(s),h(a.uploadFiles())}),n()()(),c(18,Ue,10,19,"p-card",13),n()}e&2&&(r(2),R(u(12,se)),r(6),p("disabled",a.isUploading),r(2),p("disabled",a.isUploading),r(2),C(" ",a.selectedFiles.length," archivo(s) seleccionado(s) "),r(),p("ngIf",a.selectedFiles.length>0),r(),p("ngIf",a.isUploading),r(2),p("disabled",a.isUploading||a.selectedFiles.length===0),r(),p("label",a.isUploading?"Subiendo...":"Subir boletas")("disabled",a.isUploading||a.selectedFiles.length===0)("loading",a.isUploading),r(),p("ngIf",a.uploadResponse))},dependencies:[D,A,j,K,q,J,L,ne,oe,Y,X,ie,te,W,Q,ee,Z,H],encapsulation:2})};export{re as UploadBallotsComponent};
