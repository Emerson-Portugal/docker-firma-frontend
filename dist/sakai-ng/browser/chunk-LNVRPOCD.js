import{a as Ae}from"./chunk-WTW5RUH2.js";import{e as De,g as Ve}from"./chunk-FPNHGTLK.js";import{e as qe,f as Je,h as $e,i as We,j as Ge}from"./chunk-45OTRKZG.js";import{a as Ke,b as Xe}from"./chunk-XLYG6UBL.js";import{a as at}from"./chunk-SAF4IUW2.js";import{e as Ee,g as ze,l as Ue}from"./chunk-PXHTZTO3.js";import{b as X,c as Ne,l as je,p as He,q as Qe,r as Ye}from"./chunk-77BGPX7E.js";import{$ as Be,M as le,X as ke,Y as W,_ as Me,aa as Ie,ba as G,ca as Oe,ha as Re}from"./chunk-OUHVS6X7.js";import"./chunk-TBYF2LDC.js";import{a as K}from"./chunk-XLKPKAOX.js";import{D as $,i as xe,k as Pe,l as q,n as Te,o as Se,p as Le,r as Fe,s as J,z}from"./chunk-ITE25VCI.js";import{$a as B,Ab as v,Bb as l,Cb as ye,Db as oe,Eb as f,Ga as s,Gb as h,Hb as _,Kb as be,L as F,La as V,M as fe,Ob as x,P as te,Pb as w,Q as D,Qb as ne,Rb as S,Ta as j,Tb as H,Ua as we,Ub as Q,V as m,Vb as Y,W as u,Wb as A,X as he,Xa as ve,Xb as R,Yb as E,Za as g,ec as L,fa as _e,fc as Ce,ga as ie,gc as re,hc as ae,ib as y,ic as se,jb as b,k as ue,mb as p,nb as d,ob as c,pb as T,tb as I,ub as O,v as ge,vb as k,vc as P,wb as C,wc as M}from"./chunk-TKL4FGBT.js";import{a as pe,e as rt,f as me}from"./chunk-EQDQRRRY.js";var Ze=`
    .p-dataview {
        position: relative;
        border-color: dt('dataview.border.color');
        border-width: dt('dataview.border.width');
        border-style: solid;
        border-radius: dt('dataview.border.radius');
        padding: dt('dataview.padding');
    }

    .p-dataview-header {
        background: dt('dataview.header.background');
        color: dt('dataview.header.color');
        border-color: dt('dataview.header.border.color');
        border-width: dt('dataview.header.border.width');
        border-style: solid;
        padding: dt('dataview.header.padding');
        border-radius: dt('dataview.header.border.radius');
    }

    .p-dataview-content {
        background: dt('dataview.content.background');
        border-color: dt('dataview.content.border.color');
        border-width: dt('dataview.content.border.width');
        border-style: solid;
        color: dt('dataview.content.color');
        padding: dt('dataview.content.padding');
        border-radius: dt('dataview.content.border.radius');
    }

    .p-dataview-footer {
        background: dt('dataview.footer.background');
        color: dt('dataview.footer.color');
        border-color: dt('dataview.footer.border.color');
        border-width: dt('dataview.footer.border.width');
        border-style: solid;
        padding: dt('dataview.footer.padding');
        border-radius: dt('dataview.footer.border.radius');
    }

    .p-dataview-paginator-top {
        border-width: dt('dataview.paginator.top.border.width');
        border-color: dt('dataview.paginator.top.border.color');
        border-style: solid;
    }

    .p-dataview-paginator-bottom {
        border-width: dt('dataview.paginator.bottom.border.width');
        border-color: dt('dataview.paginator.bottom.border.color');
        border-style: solid;
    }

    .p-dataview-loading-overlay {
        position: absolute;
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 2;
    }
`;var lt=["list"],dt=["grid"],ct=["header"],pt=["emptymessage"],mt=["footer"],ut=["paginatorleft"],gt=["paginatorright"],ft=["paginatordropdownitem"],ht=["loadingicon"],_t=["listicon"],wt=["gridicon"],vt=[[["p-header"]],[["p-footer"]]],yt=["p-header","p-footer"],bt=()=>({position:"top"}),tt=t=>({$implicit:t}),Ct=()=>({position:"bottom"});function xt(t,n){if(t&1&&T(0,"i"),t&2){let e=l(2);x(e.cn(e.cx("loadingIcon"),"pi-spin"+e.loadingIcon))}}function Pt(t,n){}function Tt(t,n){t&1&&g(0,Pt,0,0,"ng-template")}function St(t,n){if(t&1&&(I(0),he(),T(1,"svg",3),g(2,Tt,1,0,null,4),O()),t&2){let e=l(2);s(),x(e.cx("loadingIcon")),p("spin",!0),s(),p("ngTemplateOutlet",e.loadingicon)}}function Lt(t,n){if(t&1&&(d(0,"div")(1,"div"),y(2,xt,1,2,"i",1)(3,St,3,4,"ng-container"),c()()),t&2){let e=l();x(e.cx("loading")),s(),x(e.cx("loadingOverlay")),s(),b(e.loadingIcon?2:3)}}function Ft(t,n){t&1&&k(0)}function Dt(t,n){if(t&1&&(d(0,"div"),oe(1),g(2,Ft,1,0,"ng-container",4),c()),t&2){let e=l();x(e.cx("header")),s(2),p("ngTemplateOutlet",e.headerTemplate)}}function Vt(t,n){if(t&1){let e=C();d(0,"p-paginator",5),v("onPageChange",function(i){m(e);let r=l();return u(r.paginate(i))}),c()}if(t&2){let e=l();p("rows",e.rows)("first",e.first)("totalRecords",e.totalRecords)("pageLinkSize",e.pageLinks)("alwaysShow",e.alwaysShowPaginator)("rowsPerPageOptions",e.rowsPerPageOptions)("appendTo",e.paginatorDropdownAppendTo)("dropdownScrollHeight",e.paginatorDropdownScrollHeight)("templateLeft",e.paginatorleft)("templateRight",e.paginatorright)("currentPageReportTemplate",e.currentPageReportTemplate)("showFirstLastIcon",e.showFirstLastIcon)("dropdownItemTemplate",e.paginatordropdownitem)("showCurrentPageReport",e.showCurrentPageReport)("showJumpToPageDropdown",e.showJumpToPageDropdown)("showPageLinks",e.showPageLinks)("styleClass",e.cn(e.cx("pcPaginator",R(17,bt)),e.paginatorStyleClass))}}function kt(t,n){t&1&&k(0)}function Mt(t,n){if(t&1&&(g(0,kt,1,0,"ng-container",6),L(1,"slice")),t&2){let e=l();p("ngTemplateOutlet",e.listTemplate)("ngTemplateOutletContext",E(6,tt,e.paginator?ae(1,2,e.filteredValue||e.value,e.lazy?0:e.first,(e.lazy?0:e.first)+e.rows):e.filteredValue||e.value))}}function Bt(t,n){t&1&&k(0)}function It(t,n){if(t&1&&(g(0,Bt,1,0,"ng-container",6),L(1,"slice")),t&2){let e=l();p("ngTemplateOutlet",e.gridTemplate)("ngTemplateOutletContext",E(6,tt,e.paginator?ae(1,2,e.filteredValue||e.value,e.lazy?0:e.first,(e.lazy?0:e.first)+e.rows):e.filteredValue||e.value))}}function Ot(t,n){if(t&1&&(I(0),w(1),O()),t&2){let e=l(2);s(),S(" ",e.emptyMessageLabel," ")}}function Rt(t,n){t&1&&k(0,null,0)}function Et(t,n){if(t&1&&(d(0,"div"),g(1,Ot,2,1,"ng-container",7)(2,Rt,2,0,"ng-container",4),c()),t&2){let e=l();x(e.cx("emptyMessage")),s(),p("ngIf",!e.emptymessageTemplate)("ngIfElse",e.empty),s(),p("ngTemplateOutlet",e.emptymessageTemplate)}}function zt(t,n){if(t&1){let e=C();d(0,"p-paginator",5),v("onPageChange",function(i){m(e);let r=l();return u(r.paginate(i))}),c()}if(t&2){let e=l();p("rows",e.rows)("first",e.first)("totalRecords",e.totalRecords)("pageLinkSize",e.pageLinks)("alwaysShow",e.alwaysShowPaginator)("rowsPerPageOptions",e.rowsPerPageOptions)("appendTo",e.paginatorDropdownAppendTo)("dropdownScrollHeight",e.paginatorDropdownScrollHeight)("templateLeft",e.paginatorleft)("templateRight",e.paginatorright)("currentPageReportTemplate",e.currentPageReportTemplate)("showFirstLastIcon",e.showFirstLastIcon)("dropdownItemTemplate",e.paginatordropdownitem)("showCurrentPageReport",e.showCurrentPageReport)("showJumpToPageDropdown",e.showJumpToPageDropdown)("showPageLinks",e.showPageLinks)("styleClass",e.cn(e.cx("pcPaginator",R(17,Ct)),e.paginatorStyleClass))}}function Ut(t,n){t&1&&k(0)}function Nt(t,n){if(t&1&&(d(0,"div"),oe(1,1),g(2,Ut,1,0,"ng-container",4),c()),t&2){let e=l();x(e.cx("footer")),s(2),p("ngTemplateOutlet",e.footerTemplate)}}var jt={root:({instance:t})=>["p-dataview p-component",{"p-dataview-list":t.layout==="list","p-dataview-grid":t.layout==="grid"}],header:"p-dataview-header",loading:"p-dataview-loading",loadingOverlay:"p-dataview-loading-overlay p-overlay-mask",loadingIcon:"p-dataview-loading-icon",pcPaginator:({position:t})=>"p-dataview-paginator-"+t,content:"p-dataview-content",emptyMessage:"p-dataview-empty-message",footer:"p-dataview-footer"},et=(()=>{class t extends Re{name="dataview";theme=Ze;classes=jt;static \u0275fac=(()=>{let e;return function(i){return(e||(e=ie(t)))(i||t)}})();static \u0275prov=F({token:t,factory:t.\u0275fac})}return t})();var ce=(()=>{class t extends Ne{paginator;rows;totalRecords;pageLinks=5;rowsPerPageOptions;paginatorPosition="bottom";paginatorStyleClass;alwaysShowPaginator=!0;paginatorDropdownAppendTo;paginatorDropdownScrollHeight="200px";currentPageReportTemplate="{currentPage} of {totalPages}";showCurrentPageReport;showJumpToPageDropdown;showFirstLastIcon=!0;showPageLinks=!0;lazy;lazyLoadOnInit=!0;emptyMessage="";styleClass;gridStyleClass="";trackBy=(e,o)=>o;filterBy;filterLocale;loading;loadingIcon;first=0;sortField;sortOrder;value;layout="list";onLazyLoad=new B;onPage=new B;onSort=new B;onChangeLayout=new B;listTemplate;gridTemplate;headerTemplate;emptymessageTemplate;footerTemplate;paginatorleft;paginatorright;paginatordropdownitem;loadingicon;listicon;gridicon;header;footer;_value;filteredValue;filterValue;initialized;_layout="list";translationSubscription;_componentStyle=D(et);get emptyMessageLabel(){return this.emptyMessage||this.config.getTranslation(Oe.EMPTY_MESSAGE)}filterService=D(ke);ngOnInit(){super.ngOnInit(),this.lazy&&this.lazyLoadOnInit&&this.onLazyLoad.emit(this.createLazyLoadMetadata()),this.translationSubscription=this.config.translationObserver.subscribe(()=>{this.cd.markForCheck()}),this.initialized=!0}ngAfterViewInit(){super.ngAfterViewInit()}ngOnChanges(e){super.ngOnChanges(e),e.layout&&!e.layout.firstChange&&this.onChangeLayout.emit({layout:e.layout.currentValue}),e.value&&(this._value=e.value.currentValue,this.updateTotalRecords(),!this.lazy&&this.hasFilter()&&this.filter(this.filterValue)),(e.sortField||e.sortOrder)&&(!this.lazy||this.initialized)&&this.sort()}updateTotalRecords(){this.totalRecords=this.lazy?this.totalRecords:this._value?this._value.length:0}paginate(e){this.first=e.first,this.rows=e.rows,this.lazy&&this.onLazyLoad.emit(this.createLazyLoadMetadata()),this.onPage.emit({first:this.first,rows:this.rows})}sort(){this.first=0,this.lazy?this.onLazyLoad.emit(this.createLazyLoadMetadata()):this.value&&(this.value.sort((e,o)=>{let i=le(e,this.sortField),r=le(o,this.sortField),a=null;return i==null&&r!=null?a=-1:i!=null&&r==null?a=1:i==null&&r==null?a=0:typeof i=="string"&&typeof r=="string"?a=i.localeCompare(r):a=i<r?-1:i>r?1:0,this.sortOrder*a}),this.hasFilter()&&this.filter(this.filterValue)),this.onSort.emit({sortField:this.sortField,sortOrder:this.sortOrder})}isEmpty(){let e=this.filteredValue||this.value;return e==null||e.length==0}createLazyLoadMetadata(){return{first:this.first,rows:this.rows,sortField:this.sortField,sortOrder:this.sortOrder}}getBlockableElement(){return this.el.nativeElement.children[0]}filter(e,o="contains"){if(this.filterValue=e,this.value&&this.value.length){let i=this.filterBy.split(",");this.filteredValue=this.filterService.filter(this.value,i,e,o,this.filterLocale),this.filteredValue.length===this.value.length&&(this.filteredValue=null),this.paginator&&(this.first=0,this.totalRecords=this.filteredValue?this.filteredValue.length:this.value?this.value.length:0),this.cd.markForCheck()}}hasFilter(){return this.filterValue&&this.filterValue.trim().length>0}ngOnDestroy(){this.translationSubscription&&this.translationSubscription.unsubscribe(),super.ngOnDestroy()}static \u0275fac=(()=>{let e;return function(i){return(e||(e=ie(t)))(i||t)}})();static \u0275cmp=j({type:t,selectors:[["p-dataView"],["p-dataview"],["p-data-view"]],contentQueries:function(o,i,r){if(o&1&&(f(r,lt,5),f(r,dt,5),f(r,ct,5),f(r,pt,5),f(r,mt,5),f(r,ut,5),f(r,gt,5),f(r,ft,5),f(r,ht,5),f(r,_t,5),f(r,wt,5),f(r,Me,5),f(r,Be,5)),o&2){let a;h(a=_())&&(i.listTemplate=a.first),h(a=_())&&(i.gridTemplate=a.first),h(a=_())&&(i.headerTemplate=a.first),h(a=_())&&(i.emptymessageTemplate=a.first),h(a=_())&&(i.footerTemplate=a.first),h(a=_())&&(i.paginatorleft=a.first),h(a=_())&&(i.paginatorright=a.first),h(a=_())&&(i.paginatordropdownitem=a.first),h(a=_())&&(i.loadingicon=a.first),h(a=_())&&(i.listicon=a.first),h(a=_())&&(i.gridicon=a.first),h(a=_())&&(i.header=a.first),h(a=_())&&(i.footer=a.first)}},hostVars:2,hostBindings:function(o,i){o&2&&x(i.cn(i.cx("root"),i.styleClass))},inputs:{paginator:[2,"paginator","paginator",P],rows:[2,"rows","rows",M],totalRecords:[2,"totalRecords","totalRecords",M],pageLinks:[2,"pageLinks","pageLinks",M],rowsPerPageOptions:"rowsPerPageOptions",paginatorPosition:"paginatorPosition",paginatorStyleClass:"paginatorStyleClass",alwaysShowPaginator:[2,"alwaysShowPaginator","alwaysShowPaginator",P],paginatorDropdownAppendTo:"paginatorDropdownAppendTo",paginatorDropdownScrollHeight:"paginatorDropdownScrollHeight",currentPageReportTemplate:"currentPageReportTemplate",showCurrentPageReport:[2,"showCurrentPageReport","showCurrentPageReport",P],showJumpToPageDropdown:[2,"showJumpToPageDropdown","showJumpToPageDropdown",P],showFirstLastIcon:[2,"showFirstLastIcon","showFirstLastIcon",P],showPageLinks:[2,"showPageLinks","showPageLinks",P],lazy:[2,"lazy","lazy",P],lazyLoadOnInit:[2,"lazyLoadOnInit","lazyLoadOnInit",P],emptyMessage:"emptyMessage",styleClass:"styleClass",gridStyleClass:"gridStyleClass",trackBy:"trackBy",filterBy:"filterBy",filterLocale:"filterLocale",loading:[2,"loading","loading",P],loadingIcon:"loadingIcon",first:[2,"first","first",M],sortField:"sortField",sortOrder:[2,"sortOrder","sortOrder",M],value:"value",layout:"layout"},outputs:{onLazyLoad:"onLazyLoad",onPage:"onPage",onSort:"onSort",onChangeLayout:"onChangeLayout"},features:[A([et]),ve,_e],ngContentSelectors:yt,decls:9,vars:10,consts:[["empty",""],[3,"class"],[3,"rows","first","totalRecords","pageLinkSize","alwaysShow","rowsPerPageOptions","appendTo","dropdownScrollHeight","templateLeft","templateRight","currentPageReportTemplate","showFirstLastIcon","dropdownItemTemplate","showCurrentPageReport","showJumpToPageDropdown","showPageLinks","styleClass"],["data-p-icon","spinner",3,"spin"],[4,"ngTemplateOutlet"],[3,"onPageChange","rows","first","totalRecords","pageLinkSize","alwaysShow","rowsPerPageOptions","appendTo","dropdownScrollHeight","templateLeft","templateRight","currentPageReportTemplate","showFirstLastIcon","dropdownItemTemplate","showCurrentPageReport","showJumpToPageDropdown","showPageLinks","styleClass"],[4,"ngTemplateOutlet","ngTemplateOutletContext"],[4,"ngIf","ngIfElse"]],template:function(o,i){o&1&&(ye(vt),y(0,Lt,4,5,"div",1),y(1,Dt,3,3,"div",1),y(2,Vt,1,18,"p-paginator",2),d(3,"div"),y(4,Mt,2,8,"ng-container"),y(5,It,2,8,"ng-container"),y(6,Et,3,5,"div",1),c(),y(7,zt,1,18,"p-paginator",2),y(8,Nt,3,3,"div",1)),o&2&&(b(i.loading?0:-1),s(),b(i.header||i.headerTemplate?1:-1),s(),b(i.paginator&&(i.paginatorPosition==="top"||i.paginatorPosition=="both")?2:-1),s(),x(i.cx("content")),s(),b(i.layout==="list"?4:-1),s(),b(i.layout==="grid"?5:-1),s(),b(i.isEmpty()&&!i.loading?6:-1),s(),b(i.paginator&&(i.paginatorPosition==="bottom"||i.paginatorPosition=="both")?7:-1),s(),b(i.footer||i.footerTemplate?8:-1))},dependencies:[J,q,Te,We,$e,je,G,Fe],encapsulation:2,changeDetection:0})}return t})(),it=(()=>{class t{static \u0275fac=function(o){return new(o||t)};static \u0275mod=we({type:t});static \u0275inj=fe({imports:[ce,G,G]})}return t})();var nt=rt(at());var Z=class t{apiUrl=`${X.BASE_URL}/empleado/mis-documentos`;http=D($);tokenService=D(K);getAuthHeaders(){let n=this.tokenService.getToken();return new z({Authorization:`Bearer ${n}`,Accept:"application/json"})}getToken(){let n=localStorage.getItem("authToken");if(n)return n;let e=localStorage.getItem("user");if(e)try{let o=JSON.parse(e);return o?.token||o?.access_token||null}catch{return null}return null}getMyDocuments(){let n=this.getToken(),e=new z(pe({accept:"application/json"},n?{Authorization:`Bearer ${n}`}:{}));return this.http.get(`${this.apiUrl}`,{headers:e}).pipe(ge(o=>(console.error("Error al obtener documentos",o),ue(()=>o))))}static \u0275fac=function(e){return new(e||t)};static \u0275prov=F({token:t,factory:t.\u0275fac,providedIn:"root"})};var ee=class t{constructor(n,e){this.http=n;this.tokenSrv=e}apiUrl=`${X.BASE_URL}/empleado/verificar-firma`;authHeaders(){let n=new z({Accept:"application/json"}),e=this.tokenSrv.getToken();return e&&(n=n.set("Authorization",`Bearer ${e}`)),n}verificarFirma(n){return this.http.get(`${this.apiUrl}/${n}`,{headers:this.authHeaders()})}static \u0275fac=function(e){return new(e||t)(te($),te(K))};static \u0275prov=F({token:t,factory:t.\u0275fac,providedIn:"root"})};var At=()=>[5,10,25,50],qt=t=>({"border-t border-surface":t});function Jt(t,n){if(t&1){let e=C();d(0,"p-button",10),v("click",function(){m(e);let i=l();return u(i.goBackToYears())}),c()}}function $t(t,n){if(t&1){let e=C();d(0,"p-button",10),v("click",function(){m(e);let i=l();return u(i.home())}),c()}}function Wt(t,n){if(t&1){let e=C();d(0,"div",13),v("click",function(){let i=m(e).$implicit,r=l(2);return u(r.selectYear(i))}),T(1,"i",14),d(2,"span",15),w(3),c()()}if(t&2){let e=n.$implicit;s(3),ne(e)}}function Gt(t,n){if(t&1&&(d(0,"div",11),g(1,Wt,4,1,"div",12),c()),t&2){let e=l();s(),p("ngForOf",e.years)}}function Kt(t,n){if(t&1){let e=C();I(0),d(1,"p-button",37),v("onClick",function(){m(e);let i=l().$implicit,r=l(3);return u(r.verDocumento(i))}),c(),O()}}function Xt(t,n){if(t&1){let e=C();d(0,"p-button",38),v("onClick",function(){m(e);let i=l().$implicit,r=l(3);return u(r.descargar(i))}),c()}if(t&2){let e=l().$implicit,o=l(3);p("icon",o.validando[e.id]?"pi pi-spin pi-spinner":"pi pi-pencil")("label",o.validando[e.id]?"Validando...":"Firmar")("disabled",o.validando[e.id])}}function Zt(t,n){if(t&1&&(d(0,"div",29)(1,"div",30),w(2),c(),d(3,"div",31),w(4),c(),d(5,"div",32),w(6),L(7,"date"),c(),d(8,"div",32),w(9),L(10,"date"),c(),d(11,"div",33),T(12,"p-tag",34),L(13,"titlecase"),T(14,"span",35),g(15,Kt,2,0,"ng-container",36)(16,Xt,1,3,"ng-template",null,1,se),c()()),t&2){let e=n.$implicit,o=n.index,i=be(17),r=l(3);p("ngClass",E(17,qt,o!==0)),s(2),S(" ",e.nombre_archivo," "),s(2),S("Usuario: ",e.nombre_usuario),s(2),S("Subido: ",re(7,9,e.subido_en,"medium")),s(3),S(" Firmado: ",e.firmado_en?re(10,12,e.firmado_en,"medium"):"\u2014"," "),s(3),p("value",Ce(13,15,e.estado))("severity",r.getSeverity(e.estado)),s(3),p("ngIf",e.estado==="firmado")("ngIfElse",i)}}function ei(t,n){if(t&1&&(d(0,"div",2),g(1,Zt,18,19,"div",28),c()),t&2){let e=n.$implicit,o=l(2);s(),p("ngForOf",e)("ngForTrackBy",o.trackDoc)}}function ti(t,n){t&1&&(d(0,"div",39),w(1,"No hay facturas."),c())}function ii(t,n){if(t&1&&(d(0,"div",40),w(1),c()),t&2){let e=l(2);s(),ne(e.error)}}function oi(t,n){if(t&1){let e=C();d(0,"div")(1,"div",16)(2,"div",2)(3,"label",17),w(4,"Estado"),c(),d(5,"p-select",18),Y("ngModelChange",function(i){m(e);let r=l();return Q(r.estadoFiltro,i)||(r.estadoFiltro=i),u(i)}),v("onChange",function(){m(e);let i=l();return u(i.aplicarFiltros())}),c()(),d(6,"div",2)(7,"label",17),w(8,"Mes"),c(),d(9,"p-select",19),Y("ngModelChange",function(i){m(e);let r=l();return Q(r.mesFiltro,i)||(r.mesFiltro=i),u(i)}),v("onChange",function(){m(e);let i=l();return u(i.aplicarFiltros())}),c()(),d(10,"div",20)(11,"div",21)(12,"label",17),w(13,"Ordenar por"),c(),d(14,"p-select",22),Y("ngModelChange",function(i){m(e);let r=l();return Q(r.ordenarPor,i)||(r.ordenarPor=i),u(i)}),v("onChange",function(){m(e);let i=l();return u(i.aplicarFiltros())}),c()(),d(15,"div",23)(16,"button",24),v("click",function(){m(e);let i=l();return u(i.limpiarFiltros())}),c()()()(),d(17,"p-dataview",25),g(18,ei,2,2,"ng-template",null,0,se)(20,ti,2,0,"ng-template",26),c(),g(21,ii,2,1,"div",27),c()}if(t&2){let e=l();s(5),p("options",e.estadoOptions),H("ngModel",e.estadoFiltro),p("showClear",!0),s(4),p("options",e.meses),H("ngModel",e.mesFiltro),p("showClear",!0),s(5),p("options",e.opcionesOrden),H("ngModel",e.ordenarPor),s(3),p("value",e.documentosFiltrados)("paginator",!0)("rows",e.rows)("rowsPerPageOptions",R(15,At))("first",e.first)("alwaysShowPaginator",!1),s(4),p("ngIf",e.error)}}var ot=class t{constructor(n,e,o,i,r){this.listSvc=n;this.signSts=e;this.router=o;this.route=i;this.messageService=r}years=[];selectedYear=null;showYearView=!0;showDocumentView=!1;loading=!1;error=null;documentos=[];documentosFiltrados=[];validando={};estadoFiltro="all";mesFiltro=null;ordenarPor="recientes";estadoOptions=[{label:"Todos",value:"all"},{label:"Pendiente",value:"pendiente"},{label:"Firmado",value:"firmado"}];opcionesOrden=[{label:"M\xE1s recientes primero",value:"recientes"},{label:"M\xE1s antiguos primero",value:"antiguos"}];meses=[{label:"Enero",value:1},{label:"Febrero",value:2},{label:"Marzo",value:3},{label:"Abril",value:4},{label:"Mayo",value:5},{label:"Junio",value:6},{label:"Julio",value:7},{label:"Agosto",value:8},{label:"Septiembre",value:9},{label:"Octubre",value:10},{label:"Noviembre",value:11},{label:"Diciembre",value:12}];rows=10;first=0;extraerPeriodoDeNombre(n){if(!n)return null;let e=["enero","febrero","marzo","abril","mayo","junio","julio","agosto","septiembre","octubre","noviembre","diciembre"],i=(N=>N.normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase())(n),r=null;if(i.includes("setiembre"))r="septiembre";else for(let N of e)if(i.includes(N)){r=N;break}if(!r)return console.debug("[extraerPeriodoDeNombre] Mes no detectado en:",n),null;let a=e.indexOf(r);if(a===-1)return null;let U=i.match(/(19|20)\d{2}/);return U?{year:Number(U[0]),month:a+1}:(console.debug("[extraerPeriodoDeNombre] A\xF1o no detectado en:",n),null)}getFechaPeriodo(n){let e=this.extraerPeriodoDeNombre(n.nombre_archivo);return e?new Date(e.year,e.month-1,1):null}ngOnInit(){this.route.queryParams.subscribe(n=>{let e=n.year,o=e?Number(e):null;o&&!Number.isNaN(o)?(this.selectedYear=o,this.showYearView=!1,this.showDocumentView=!0):(this.selectedYear=null,this.showYearView=!0,this.showDocumentView=!1),this.aplicarFiltros()}),this.cargar()}cargar(){this.loading=!0,this.error=null,this.listSvc.getMyDocuments().subscribe({next:n=>{this.documentos=n.documentos??[];let e=new Set;this.documentos.forEach(o=>{let i=this.extraerPeriodoDeNombre(o.nombre_archivo);if(i)e.add(i.year);else if(o.subido_en){let r=new Date(o.subido_en).getFullYear();Number.isNaN(r)||e.add(r)}});try{let o=this.documentos.slice(0,20).map(i=>({id:i.id,nombre_archivo:i.nombre_archivo,subido_en:i.subido_en,periodo:this.extraerPeriodoDeNombre(i.nombre_archivo)}));console.table(o)}catch(o){console.log("[ListBallotsUser] Debug periodos error:",o)}this.years=Array.from(e).sort((o,i)=>i-o),this.aplicarFiltros(),this.loading=!1},error:n=>{this.error=n?.error?.detail||"No se pudieron cargar los documentos.",this.documentos=[],this.documentosFiltrados=[],this.years=[],this.loading=!1}})}limpiarFiltros(){this.estadoFiltro="all",this.mesFiltro=null,this.ordenarPor="recientes",this.first=0,this.aplicarFiltros()}aplicarFiltros(){console.log("[ListBallotsUser] aplicarFiltros()",{estadoFiltro:this.estadoFiltro,mesFiltro:this.mesFiltro,selectedYear:this.selectedYear,ordenarPor:this.ordenarPor,totalDocs:this.documentos.length});try{let e=this.documentos.slice(0,20).map(o=>({id:o.id,nombre_archivo:o.nombre_archivo,periodo:this.extraerPeriodoDeNombre(o.nombre_archivo),subido_en:o.subido_en}));console.table(e)}catch{}let n=this.documentos.filter(e=>{let o=this.estadoFiltro==="all"||(e.estado||"").toLowerCase()===this.estadoFiltro,i=this.extraerPeriodoDeNombre(e.nombre_archivo),r=!0;this.mesFiltro&&(i?r=i.month===this.mesFiltro:e.subido_en?r=new Date(e.subido_en).getMonth()+1===this.mesFiltro:r=!1);let a=!0;return this.selectedYear&&(i?a=i.year===this.selectedYear:e.subido_en?a=new Date(e.subido_en).getFullYear()===this.selectedYear:a=!1),o&&r&&a});n.sort((e,o)=>{let i=this.getFechaPeriodo(e)?.getTime()??(e.subido_en?new Date(e.subido_en).getTime():0),r=this.getFechaPeriodo(o)?.getTime()??(o.subido_en?new Date(o.subido_en).getTime():0);return this.ordenarPor==="recientes"?r-i:i-r}),this.documentosFiltrados=n,console.log("[ListBallotsUser] result",{mostrados:this.documentosFiltrados.length})}getSeverity(n){let e=(n||"").toLowerCase();return e==="firmado"?"success":e==="pendiente"?"danger":"info"}trackDoc=(n,e)=>e.id;selectYear(n){this.selectedYear=n,this.showYearView=!1,this.showDocumentView=!0,this.aplicarFiltros(),this.router.navigate([],{relativeTo:this.route,queryParams:{year:n},queryParamsHandling:"merge"})}goBackToYears(){this.selectedYear=null,this.showYearView=!0,this.showDocumentView=!1,this.aplicarFiltros(),this.router.navigate([],{relativeTo:this.route,queryParams:{year:null},queryParamsHandling:"merge"})}descargar(n){return me(this,null,function*(){this.validando[n.id]=!0;try{let e=yield this.signSts.verificarFirma(n.id).toPromise();if(e?.puede_firmar)this.router.navigate(["/signature/sign-ballots",n.id],{state:{doc:n},queryParamsHandling:"preserve"});else{let o=e?.documento_pendiente,i=o?`Tienes el documento "${o.nombre}" (${o.fecha}) pendiente de firmar.`:"Tienes documentos pendientes de firmar.";yield nt.default.fire({title:"Documentos pendientes",html:`${i}<br>Por favor, f\xEDrmalos en orden cronol\xF3gico.`,icon:"warning",confirmButtonText:"Entendido",confirmButtonColor:"#3085d6",showCloseButton:!0})}}catch(e){console.error("Error al verificar documentos:",e),this.messageService.add({severity:"error",summary:"Error",detail:"Ocurri\xF3 un error al verificar el estado del documento",life:5e3})}finally{this.validando[n.id]=!1}})}verDocumento(n){this.router.navigate(["/signature/sign-ballots",n.id],{state:{doc:n},queryParamsHandling:"preserve"})}home(){window.location.href="/signature/home"}static \u0275fac=function(e){return new(e||t)(V(Z),V(ee),V(Ve),V(De),V(W))};static \u0275cmp=j({type:t,selectors:[["app-list-ballots-user"]],features:[A([W])],decls:10,vars:6,consts:[["list",""],["firmarButton",""],[1,"flex","flex-col"],["message","Cargando documentos...",3,"isLoading"],[1,"card","relative"],[1,"flex","items-center","mb-3"],["icon","pi pi-arrow-left","styleClass","p-button-danger p-button-rounded p-button-text mr-2",3,"click",4,"ngIf"],[1,"font-semibold","text-xl"],["class","grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6 p-4 justify-center",4,"ngIf"],[4,"ngIf"],["icon","pi pi-arrow-left","styleClass","p-button-danger p-button-rounded p-button-text mr-2",3,"click"],[1,"grid","grid-cols-1","sm:grid-cols-2","md:grid-cols-3","lg:grid-cols-4","gap-6","p-4","justify-center"],["class","p-6 border rounded shadow hover:shadow-md cursor-pointer transition-transform transform hover:-translate-y-1 bg-white flex flex-col items-center",3,"click",4,"ngFor","ngForOf"],[1,"p-6","border","rounded","shadow","hover:shadow-md","cursor-pointer","transition-transform","transform","hover:-translate-y-1","bg-white","flex","flex-col","items-center",3,"click"],[1,"pi","pi-folder","text-5xl","text-primary-500","mb-3"],[1,"font-semibold","text-lg"],[1,"grid","grid-cols-1","md:grid-cols-3","gap-4","mb-4"],[1,"block","text-600","text-sm","font-medium","mb-2"],["optionLabel","label","optionValue","value","placeholder","Filtrar por estado","styleClass","w-full",3,"ngModelChange","onChange","options","ngModel","showClear"],["optionLabel","label","optionValue","value","placeholder","Filtrar por mes","styleClass","w-full",3,"ngModelChange","onChange","options","ngModel","showClear"],[1,"flex","items-end","gap-2"],[1,"flex-1","flex","flex-col"],["optionLabel","label","optionValue","value","styleClass","w-full",3,"ngModelChange","onChange","options","ngModel"],[1,"flex","items-end"],["pButton","","type","button","icon","pi pi-filter-slash","label","Limpiar",1,"p-button-text","p-button-sm",2,"height","36px","margin-bottom","2px",3,"click"],["layout","list","paginatorPosition","both",3,"value","paginator","rows","rowsPerPageOptions","first","alwaysShowPaginator"],["pTemplate","empty"],["class","mt-3 text-red-600",4,"ngIf"],["class","flex flex-col p-6 gap-3",3,"ngClass",4,"ngFor","ngForOf","ngForTrackBy"],[1,"flex","flex-col","p-6","gap-3",3,"ngClass"],[1,"text-lg","font-medium","break-all","text-blue-600"],[1,"mt-1","text-surface-500","text-sm"],[1,"text-surface-500","text-sm"],[1,"mt-2","flex","items-center","gap-3","flex-nowrap"],[1,"shrink-0",3,"value","severity"],[1,"grow"],[4,"ngIf","ngIfElse"],["icon","pi pi-eye","label","Ver","severity","info","raised","","size","small",1,"shrink-0","whitespace-nowrap","px-5","h-9","rounded-md",3,"onClick"],["severity","success","raised","","size","small",1,"shrink-0","whitespace-nowrap","px-5","h-9","rounded-md",3,"onClick","icon","label","disabled"],[1,"p-6","text-center","text-surface-500"],[1,"mt-3","text-red-600"]],template:function(e,o){e&1&&(d(0,"div",2),T(1,"app-loading",3),d(2,"div",4)(3,"div",5),g(4,Jt,1,0,"p-button",6)(5,$t,1,0,"p-button",6),d(6,"div",7),w(7),c()(),g(8,Gt,2,1,"div",8)(9,oi,22,16,"div",9),c()()),e&2&&(s(),p("isLoading",o.loading),s(3),p("ngIf",!o.showYearView),s(),p("ngIf",o.showYearView),s(2),S(" ",o.showYearView?"Mis Documentos":"Documentos del a\xF1o "+o.selectedYear," "),s(),p("ngIf",o.showYearView),s(),p("ngIf",o.showDocumentView))},dependencies:[J,xe,Pe,q,Ue,Ee,ze,it,ce,Ie,Ge,Xe,Ke,Ye,He,Qe,Ae,Je,qe,Se,Le],encapsulation:2})};export{ot as ListBallotsUserComponent};
